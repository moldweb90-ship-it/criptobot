<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Price Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      margin: 0 auto;
      padding: 20px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .crypto-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
      margin: 30px auto 0;
    }

    .crypto-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 15px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
      min-height: 220px;
    }

    .crypto-card:hover {
      transform: translateY(-5px);
    }

    .header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      color: white;
    }

    .icon.btc { background: linear-gradient(135deg, #f7931a 0%, #ffa726 100%); }
    .icon.eth { background: linear-gradient(135deg, #627eea 0%, #8c9eff 100%); }
    .icon.sol { background: linear-gradient(135deg, #9945ff 0%, #14f195 100%); }
    .icon.xrp { background: linear-gradient(135deg, #23292f 0%, #4a90e2 100%); }
    .icon.bnb { background: linear-gradient(135deg, #f3ba2f 0%, #f7d794 100%); }
    .icon.doge { background: linear-gradient(135deg, #c2a633 0%, #d4c17d 100%); }

    .title {
      font-size: 14px;
      font-weight: 700;
      color: #2d3748;
    }

    .subtitle {
      font-size: 10px;
      color: #718096;
      margin-top: 2px;
    }

    .price-display {
      text-align: center;
      margin: 15px 0;
    }

    .price {
      font-size: 20px;
      font-weight: 800;
      color: #2d3748;
      margin-bottom: 4px;
      transition: all 0.3s ease;
    }

    .price.flash-green {
      animation: flashGreen 0.5s;
    }

    .price.flash-red {
      animation: flashRed 0.5s;
    }

    @keyframes flashGreen {
      0%, 100% { color: #2d3748; }
      50% { color: #48bb78; transform: scale(1.05); }
    }

    @keyframes flashRed {
      0%, 100% { color: #2d3748; }
      50% { color: #f56565; transform: scale(1.05); }
    }

    .change {
      font-size: 16px;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 12px;
      display: inline-block;
    }

    .change.positive {
      background: #c6f6d5;
      color: #22543d;
    }

    .change.negative {
      background: #fed7d7;
      color: #742a2a;
    }

    .spread {
      font-size: 16px;
      font-weight: 600;
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 12px;
      background: #e2e8f0;
      color: #4a5568;
    }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-top: 12px;
    }

    .stats .stat-item:nth-child(5),
    .stats .stat-item:nth-child(6) {
      grid-column: 1 / -1;
      font-size: 10px;
    }

    .stat-item {
      background: #f7fafc;
      padding: 10px;
      border-radius: 8px;
    }

    .stat-label {
      font-size: 10px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 3px;
    }

    .stat-value {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }

    .status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 20px;
      font-size: 14px;
      color: #718096;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #48bb78;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .loading {
      text-align: center;
      color: #718096;
    }

    /* Стили для секции аналитики */
    .analytics-section {
      margin-top: 40px;
      padding: 0 20px;
    }

    .analytics-title {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 30px;
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
      margin: 0 auto;
    }

    .analytics-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .analytics-card:hover {
      transform: translateY(-3px);
    }

    .analytics-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e2e8f0;
    }

    .analytics-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      color: white;
    }

    .analytics-name {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }

    .indicator {
      margin-bottom: 12px;
      padding: 8px;
      background: #f7fafc;
      border-radius: 8px;
    }

    .indicator-label {
      font-size: 11px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 3px;
    }

    .indicator-value {
      font-size: 13px;
      font-weight: 600;
      color: #2d3748;
    }

    .indicator-value.positive {
      color: #48bb78;
    }

    .indicator-value.negative {
      color: #f56565;
    }

    .indicator-value.neutral {
      color: #718096;
    }

    .macd-values {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px;
      margin-top: 5px;
    }

    .macd-item {
      font-size: 10px;
      padding: 3px;
      background: #edf2f7;
      border-radius: 4px;
      text-align: center;
    }

    /* Секция аналитики */
    .analytics-section {
      margin-top: 40px;
      padding: 20px;
      background: #f8fafc;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      width: 100%;
      clear: both;
    }

    .analytics-title {
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    /* Принудительно 6 колонок для всех экранов */
    @media (max-width: 1200px) {
      .crypto-grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
      }
      .analytics-grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
      }
    }

    .analytics-card {
      background: white;
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .analytics-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .analytics-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f1f5f9;
    }

    .analytics-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .analytics-icon.btc { background: linear-gradient(135deg, #f7931a 0%, #ffa726 100%); }
    .analytics-icon.eth { background: linear-gradient(135deg, #627eea 0%, #8c9eff 100%); }
    .analytics-icon.sol { background: linear-gradient(135deg, #9945ff 0%, #14f195 100%); }
    .analytics-icon.xrp { background: linear-gradient(135deg, #23292f 0%, #4a90e2 100%); }
    .analytics-icon.bnb { background: linear-gradient(135deg, #f3ba2f 0%, #f7d794 100%); }
    .analytics-icon.doge { background: linear-gradient(135deg, #c2a633 0%, #d4c17d 100%); }

    .analytics-name {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }

    .trend-indicators {
      margin-left: auto;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .trend-line {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .trend-label {
      font-size: 10px;
      font-weight: 700;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .trend-percentage {
      font-size: 12px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 4px;
      background: #e2e8f0;
      color: #4a5568;
      transition: all 0.3s ease;
    }

    .trend-percentage.long-active {
      background: #48bb78;
      color: white;
    }

    .trend-percentage.short-active {
      background: #f56565;
      color: white;
    }

    .indicator-label-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }

    .dot.green {
      background: #48bb78;
    }

    .dot.red {
      background: #f56565;
    }

    .dot.neutral {
      background: #e2e8f0;
    }

    .dot.yellow {
      background: #f6e05e;
    }

    .dot.blue {
      background: #4299e1;
    }

    .dot.orange {
      background: #ed8936;
    }

    .dot.red {
      background: #f56565;
    }

    .dot.maroon {
      background: #c53030;
    }

    .dot.volatile {
      background: #e53e3e;
      color: white;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      width: 16px;
      height: 16px;
      border: 2px solid #c53030;
    }

    .dot.caution {
      background: #f6e05e;
    }

    .dot.anomaly {
      background: #e53e3e;
      color: white;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      width: 16px;
      height: 16px;
      border: 2px solid #c53030;
    }

    .indicator-value-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .trend-indicator {
      font-size: 14px;
      font-weight: bold;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .trend-indicator.positive {
      background: #48bb78;
      color: white;
    }

    .trend-indicator.positive::after {
      content: '✓';
    }

    .trend-indicator.negative {
      background: #f56565;
      color: white;
    }

    .trend-indicator.negative::after {
      content: '↓';
    }

    .trend-indicator.neutral {
      background: #e2e8f0;
      color: #718096;
    }

    .trend-indicator.neutral::after {
      content: '--';
      font-size: 10px;
    }

    .indicator {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      padding: 6px 10px;
      background: #f8fafc;
      border-radius: 6px;
      border-left: 3px solid #e2e8f0;
      transition: all 0.2s ease;
    }

    .indicator:hover {
      background: #f1f5f9;
      border-left-color: #4299e1;
    }

    .indicator.liquidity {
      min-width: 200px;
      flex-wrap: wrap;
    }
    
    .indicator.liquidity .indicator-value {
      font-size: 11px;
      min-width: 120px;
      text-align: right;
    }

    .indicator-label {
      font-size: 11px;
      font-weight: 500;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .indicator-value {
      font-size: 12px;
      font-weight: 600;
      padding: 3px 6px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .indicator-value.positive {
      color: #38a169;
      background: #f0fff4;
      border: 1px solid #c6f6d5;
    }

    .indicator-value.negative {
      color: #e53e3e;
      background: #fff5f5;
      border: 1px solid #fed7d7;
    }

    .indicator-value.neutral {
      color: #718096;
      background: #f7fafc;
      border: 1px solid #e2e8f0;
    }


    /* Торговые сигналы */
    .signals-section {
      margin-top: 30px;
      width: 100%;
      display: flex;
      gap: 20px;
    }

    .signals-container {
      flex: 1;
      width: 50%;
    }

    .positions-container {
      flex: 1;
      width: 50%;
    }

    .signals-title, .positions-title, .market-title {
      text-align: center;
      color: white;
      font-size: 24px;
      margin-bottom: 20px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      letter-spacing: 1px;
    }

    .analytics-title {
      text-align: center;
      color: #2d3748;
      font-size: 24px;
      margin-bottom: 20px;
      text-shadow: none;
      letter-spacing: 1px;
    }

    .market-section {
      margin-top: 30px;
      width: 100%;
    }

    .positions-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 20px;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #718096;
      font-size: 16px;
    }

    .signals-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .signal-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .signal-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e2e8f0;
    }

    .signal-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .signal-name {
      font-size: 13px;
      font-weight: 700;
      color: #2d3748;
    }

    .signal-badge {
      margin-left: auto;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .signal-badge.buy {
      background: #48bb78;
      color: white;
    }

    .signal-badge.sell {
      background: #f56565;
      color: white;
    }

    .signal-badge.hold {
      background: #ecc94b;
      color: #2d3748;
    }

    .confidence-bar {
      margin: 10px 0;
    }

    .confidence-label {
      font-size: 10px;
      color: #718096;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
    }

    .confidence-progress {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
    }

    .confidence-fill {
      height: 100%;
      transition: width 0.5s ease, background 0.3s ease;
      border-radius: 4px;
    }

    .confidence-fill.high {
      background: linear-gradient(90deg, #48bb78, #38a169);
    }

    .confidence-fill.medium {
      background: linear-gradient(90deg, #ecc94b, #d69e2e);
    }

    .confidence-fill.low {
      background: linear-gradient(90deg, #cbd5e0, #a0aec0);
    }

    .signal-metrics {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 10px;
    }

    .signal-metric {
      display: flex;
      justify-content: space-between;
      font-size: 10px;
      padding: 4px 8px;
      background: #f7fafc;
      border-radius: 4px;
    }

    .signal-metric-label {
      color: #718096;
      font-weight: 500;
    }

    .signal-metric-value {
      font-weight: 700;
      color: #2d3748;
    }

    .signal-metric-value.green {
      color: #38a169;
    }

    .signal-metric-value.red {
      color: #e53e3e;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Секция торговых сигналов и позиций -->
    <div class="signals-section">
      <div class="signals-container">
        <h2 class="signals-title">🎯 Торговые сигналы</h2>
        <div class="signals-grid" id="signalsGrid">
          <!-- Сигналы будут добавлены через JavaScript -->
        </div>
      </div>
      
      <div class="positions-container">
        <h2 class="positions-title">📊 Открытые позиции</h2>
        <div class="positions-content">
          Позиции будут отображаться здесь
        </div>
      </div>
    </div>

    <!-- Рыночные данные -->
    <div class="market-section">
      <h2 class="market-title">💰 Рыночные данные</h2>
      <div class="crypto-grid" id="cryptoGrid">
        <!-- Криптовалюты будут добавлены через JavaScript -->
      </div>
    </div>

    <!-- Секция аналитики -->
    <div class="analytics-section">
        <h2 class="analytics-title">📊 Техническая аналитика (15m)</h2>
      <div class="analytics-grid" id="analyticsGrid">
        <!-- Аналитика будет добавлена через JavaScript -->
      </div>
    </div>
  </div>

  <script>
    const ws = new WebSocket('ws://localhost:5000');
    const cryptoGrid = document.getElementById('cryptoGrid');
    const analyticsGrid = document.getElementById('analyticsGrid');
    const signalsGrid = document.getElementById('signalsGrid');
    const lastPrices = {};
    
    // Конфигурация криптовалют
    const cryptoConfig = {
      'BTCUSDT': { name: 'Bitcoin', symbol: '₿', class: 'btc' },
      'ETHUSDT': { name: 'Ethereum', symbol: 'Ξ', class: 'eth' },
      'SOLUSDT': { name: 'Solana', symbol: '◎', class: 'sol' },
      'XRPUSDT': { name: 'Ripple', symbol: '✕', class: 'xrp' },
      'BNBUSDT': { name: 'BNB', symbol: 'B', class: 'bnb' },
      'DOGEUSDT': { name: 'Dogecoin', symbol: 'Ð', class: 'doge' }
    };

    // Создаем карточки для всех криптовалют
    Object.keys(cryptoConfig).forEach(symbol => {
      const config = cryptoConfig[symbol];
      const card = createCryptoCard(symbol, config);
      cryptoGrid.appendChild(card);
      
      // Создаем аналитическую карточку
      const analyticsCard = createAnalyticsCard(symbol, config);
      analyticsGrid.appendChild(analyticsCard);

      // Создаем карточку торговых сигналов
      const signalCard = createSignalCard(symbol, config);
      signalsGrid.appendChild(signalCard);
    });

    function createCryptoCard(symbol, config) {
      const card = document.createElement('div');
      card.className = 'crypto-card';
      card.id = `card-${symbol}`;
      
      card.innerHTML = `
        <div class="header">
          <div class="icon ${config.class}">${config.symbol}</div>
          <div>
            <div class="title">${config.name}</div>
            <div class="subtitle">${symbol}/USDT Futures</div>
          </div>
        </div>

        <div class="price-display">
          <div class="price" id="price-${symbol}">Загрузка...</div>
          <div class="change" id="change-${symbol}">--</div>
        </div>

        <div class="stats">
          <div class="stat-item">
            <div class="stat-label">Максимум 24ч</div>
            <div class="stat-value" id="high-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Минимум 24ч</div>
            <div class="stat-value" id="low-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Объем 24ч</div>
            <div class="stat-value" id="volume-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Обновлено</div>
            <div class="stat-value" id="time-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Точность</div>
            <div class="stat-value" id="precision-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Raw Data</div>
            <div class="stat-value" id="raw-${symbol}">--</div>
          </div>
        </div>

        <div class="status">
          <div class="status-dot"></div>
          <span>Подключено к Binance Futures</span>
        </div>
      `;
      
      return card;
    }

    function createAnalyticsCard(symbol, config) {
      const card = document.createElement('div');
      card.className = 'analytics-card';
      card.id = `analytics-${symbol}`;
      
      card.innerHTML = `
        <div class="analytics-header">
          <div class="analytics-icon ${config.class}">${config.symbol}</div>
          <div class="analytics-name">${config.name}</div>
          <div class="trend-indicators">
            <div class="trend-line">
              <span class="trend-label">LONG:</span>
              <span class="trend-percentage" id="long-percentage-${symbol}">0%</span>
            </div>
            <div class="trend-line">
              <span class="trend-label">SHORT:</span>
              <span class="trend-percentage" id="short-percentage-${symbol}">0%</span>
            </div>
          </div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="dot1-${symbol}"></div>
            <div class="indicator-label">EMA 9</div>
          </div>
          <div class="indicator-value" id="ema9-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="dot2-${symbol}"></div>
            <div class="indicator-label">EMA 21</div>
          </div>
          <div class="indicator-value" id="ema21-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="dot3-${symbol}"></div>
            <div class="indicator-label">EMA 50</div>
          </div>
          <div class="indicator-value" id="ema50-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="rsi-dot-${symbol}"></div>
            <div class="indicator-label">RSI (14)</div>
          </div>
          <div class="indicator-value" id="rsi-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="macd-dot-${symbol}"></div>
            <div class="indicator-label">MACD</div>
          </div>
          <div class="indicator-value" id="macd-${symbol}">--</div>
          <div class="macd-values" id="macd-details-${symbol}">
            <div class="macd-item">Signal: --</div>
            <div class="macd-item">Hist: --</div>
          </div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="atr-dot-${symbol}"></div>
            <div class="indicator-label">ATR (14)</div>
          </div>
          <div class="indicator-value" id="atr-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="volume-dot-${symbol}"></div>
            <div class="indicator-label">Volume Ratio</div>
          </div>
          <div class="indicator-value" id="volume-ratio-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label">Spread</div>
          <div class="indicator-value" id="spread-${symbol}">--</div>
        </div>
        
        <div class="indicator liquidity">
          <div class="indicator-label-container">
            <div class="dot neutral" id="liquidity-dot-${symbol}"></div>
            <div class="indicator-label">Liquidity (±0.10%)</div>
          </div>
          <div class="indicator-value" id="liquidity-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="bid-ask-dot-${symbol}"></div>
            <div class="indicator-label">Bid/Ask Ratio</div>
          </div>
          <div class="indicator-value" id="bid-ask-ratio-${symbol}">--</div>
        </div>
      `;
      
      return card;
    }

    function createSignalCard(symbol, config) {
      const card = document.createElement('div');
      card.className = 'signal-card';
      card.id = `signal-${symbol}`;
      
      card.innerHTML = `
        <div class="signal-header">
          <div class="signal-icon ${config.class}">${config.symbol}</div>
          <div class="signal-name">${config.name}</div>
          <div class="signal-badge hold" id="signal-badge-${symbol}">HOLD</div>
        </div>
        
        <div class="confidence-bar">
          <div class="confidence-label">
            <span>Confidence</span>
            <span id="confidence-value-${symbol}">0%</span>
          </div>
          <div class="confidence-progress">
            <div class="confidence-fill low" id="confidence-fill-${symbol}" style="width: 0%"></div>
          </div>
        </div>
        
        <div class="signal-metrics">
          <div class="signal-metric">
            <span class="signal-metric-label">Entry</span>
            <span class="signal-metric-value" id="entry-${symbol}">--</span>
          </div>
          <div class="signal-metric">
            <span class="signal-metric-label">TP</span>
            <span class="signal-metric-value green" id="tp-${symbol}">--</span>
          </div>
          <div class="signal-metric">
            <span class="signal-metric-label">SL</span>
            <span class="signal-metric-value red" id="sl-${symbol}">--</span>
          </div>
          <div class="signal-metric">
            <span class="signal-metric-label">R:R</span>
            <span class="signal-metric-value" id="rr-${symbol}">--</span>
          </div>
        </div>
      `;
      
      return card;
    }

    function updateCryptoCard(symbol, data) {
      const priceEl = document.getElementById(`price-${symbol}`);
      const changeEl = document.getElementById(`change-${symbol}`);
      const highEl = document.getElementById(`high-${symbol}`);
      const lowEl = document.getElementById(`low-${symbol}`);
      const volumeEl = document.getElementById(`volume-${symbol}`);
      const timeEl = document.getElementById(`time-${symbol}`);
      const precisionEl = document.getElementById(`precision-${symbol}`);
      const rawEl = document.getElementById(`raw-${symbol}`);

      // Анимация изменения цены
      if (lastPrices[symbol] !== undefined) {
        priceEl.classList.remove('flash-green', 'flash-red');
        if (data.futures.price > lastPrices[symbol]) {
          priceEl.classList.add('flash-green');
        } else if (data.futures.price < lastPrices[symbol]) {
          priceEl.classList.add('flash-red');
        }
      }
      
      lastPrices[symbol] = data.futures.price;

      // Обновление данных
      priceEl.textContent = `$${data.futures.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
      
      changeEl.textContent = `${data.futures.change24h >= 0 ? '+' : ''}${data.futures.change24h.toFixed(2)}%`;
      changeEl.className = `change ${data.futures.change24h >= 0 ? 'positive' : 'negative'}`;
      
      highEl.textContent = `$${data.futures.high24h.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
      lowEl.textContent = `$${data.futures.low24h.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
      volumeEl.textContent = `${(data.futures.volume24h / 1000).toFixed(1)}K ${symbol.replace('USDT', '')}`;
      timeEl.textContent = new Date().toLocaleTimeString('ru-RU');
      precisionEl.textContent = data.futures.price.toFixed(8);
      rawEl.textContent = data.futures.rawData;
    }

    function updateAnalyticsCard(symbol, data) {
      if (!data) return;

      // Отладочная информация
      console.log(`🔍 Updating analytics for ${symbol} (${data.timeframe || '15m'}):`, data);

      // Технические индикаторы
      if (data.analytics) {
        const analytics = data.analytics;
        
        // Обновляем LONG и SHORT проценты
        updateLongPercentage(symbol, analytics);
        updateShortPercentage(symbol, analytics);
        
        // EMA индикаторы
        updateIndicator(`ema9-${symbol}`, analytics.ema9, 'price');
        updateIndicator(`ema21-${symbol}`, analytics.ema21, 'price');
        updateIndicator(`ema50-${symbol}`, analytics.ema50, 'price');
        
          // Обновляем точки тренда
          updateTrendDots(symbol, analytics.isUptrend, analytics.isDowntrend);
          
          // Обновляем Bid/Ask сигнал
          updateBidAskSignal(symbol, analytics);
          
          // Обновляем Volume сигнал
          updateVolumeSignal(symbol, analytics);
          
          // Обновляем RSI сигнал
          updateRsiSignal(symbol, analytics);
          
          // Обновляем Liquidity сигнал
          updateLiquiditySignal(symbol, analytics);
          
          // Обновляем MACD сигнал
          updateMacdSignal(symbol, analytics);
          
          // Обновляем ATR сигнал
          updateAtrSignal(symbol, analytics);
        
        // MACD
        if (analytics.macd) {
          updateIndicator(`macd-${symbol}`, analytics.macd.macd, 'price');
          
          const macdDetails = document.getElementById(`macd-details-${symbol}`);
          if (macdDetails) {
            macdDetails.innerHTML = `
              <div class="macd-item">Signal: ${analytics.macd.signal ? analytics.macd.signal.toFixed(4) : '--'}</div>
              <div class="macd-item">Hist: ${analytics.macd.histogram ? analytics.macd.histogram.toFixed(4) : '--'}</div>
            `;
          }
        }
        
        // ATR
        updateIndicator(`atr-${symbol}`, analytics.atr, 'atr');
        
        // Volume Ratio
        updateIndicator(`volume-ratio-${symbol}`, analytics.volumeRatio, 'ratio');
      }
      
      // Данные стакана заявок
      if (data.orderBook) {
        updateIndicator(`spread-${symbol}`, data.orderBook.spreadPercent, 'spread');
        updateIndicator(`liquidity-${symbol}`, data.orderBook.totalLiquidity, 'liquidity');
        updateIndicator(`bid-ask-ratio-${symbol}`, data.orderBook.bidAskRatio, 'bid-ask-ratio');
      }
    }

    function updateLongPercentage(symbol, analytics) {
      const longPercentageEl = document.getElementById(`long-percentage-${symbol}`);
      if (!longPercentageEl) return;

      const percentage = analytics.longPercentage || 0;
      longPercentageEl.textContent = `${percentage}%`;
      
      if (percentage > 0) {
        longPercentageEl.classList.add('long-active');
      } else {
        longPercentageEl.classList.remove('long-active');
      }
    }

    function updateShortPercentage(symbol, analytics) {
      const shortPercentageEl = document.getElementById(`short-percentage-${symbol}`);
      if (!shortPercentageEl) return;

      const percentage = analytics.shortPercentage || 0;
      shortPercentageEl.textContent = `${percentage}%`;
      
      if (percentage > 0) {
        shortPercentageEl.classList.add('short-active');
      } else {
        shortPercentageEl.classList.remove('short-active');
      }
    }

      function updateTrendDots(symbol, isUptrend, isDowntrend) {
        const dot1 = document.getElementById(`dot1-${symbol}`);
        const dot2 = document.getElementById(`dot2-${symbol}`);
        const dot3 = document.getElementById(`dot3-${symbol}`);
        
        if (!dot1 || !dot2 || !dot3) return;
      
        if (isUptrend) {
          // Зеленые точки для восходящего тренда
          dot1.className = 'dot green';
          dot2.className = 'dot green';
          dot3.className = 'dot green';
        } else if (isDowntrend) {
          // Красные точки для нисходящего тренда
          dot1.className = 'dot red';
          dot2.className = 'dot red';
          dot3.className = 'dot red';
        } else {
          // Серые точки для нейтрального тренда
          dot1.className = 'dot neutral';
          dot2.className = 'dot neutral';
          dot3.className = 'dot neutral';
        }
      }

      function updateBidAskSignal(symbol, analytics) {
        const bidAskDot = document.getElementById(`bid-ask-dot-${symbol}`);
        if (!bidAskDot) return;
      
        const signal = analytics.bidAskSignal || 'neutral';
        const ratio = analytics.bidAskRatio || 1.0;
        
        // Bid/Ask - ромбики (borderRadius: 2px + rotate 45deg)
        bidAskDot.style.borderRadius = '2px';
        bidAskDot.style.transform = 'rotate(45deg)';
        
        // Обновляем цвет ромба в зависимости от силы сигнала
        switch (signal) {
          case 'long':
            // Зелёный ромб - устойчивое доминирование покупателей (2.0x-5.0x)
            bidAskDot.className = 'dot green';
            bidAskDot.innerHTML = '';
            break;
          case 'short':
            // Красный ромб - явный перекос в сторону продавцов (0.10x-0.90x)
            bidAskDot.className = 'dot red';
            bidAskDot.innerHTML = '';
            break;
          case 'volatile':
            // Волатильность - красный крестик (резкий скачок > 1.0)
            bidAskDot.className = 'dot volatile';
            bidAskDot.innerHTML = '✕';
            break;
          default:
            // Серый кружок - нет сильного дисбаланса
            bidAskDot.className = 'dot neutral';
            bidAskDot.innerHTML = '';
        }
        
        // Обновляем значение Bid/Ask Ratio с дополнительной информацией
        const bidAskElement = document.getElementById(`bid-ask-ratio-${symbol}`);
        if (bidAskElement) {
          let displayText = `${ratio.toFixed(2)}x`;
          if (analytics.bidAskConfidence > 0) {
            displayText += ` (+${analytics.bidAskConfidence}%)`;
          }
          bidAskElement.textContent = displayText;
        }
      }

      function updateVolumeSignal(symbol, analytics) {
        const volumeDot = document.getElementById(`volume-dot-${symbol}`);
        if (!volumeDot) return;
      
        const signal = analytics.volumeSignal || 'neutral';
        const ratio = analytics.volumeRatio;
        
        // Volume - квадратики (borderRadius: 2px)
        volumeDot.style.borderRadius = '2px';
        volumeDot.style.transform = 'none';
        
        // Обновляем цвет квадрата в зависимости от силы сигнала
        switch (signal) {
          case 'long-weak':
            // Зелёный квадрат - объем растет (1.5-1.99)
            volumeDot.className = 'dot green';
            volumeDot.innerHTML = '';
            break;
          case 'long-strong':
            // Зелёный квадрат - сильный рост объема (2.0-2.99)
            volumeDot.className = 'dot green';
            volumeDot.innerHTML = '';
            break;
          case 'short-weak':
            // Красный кружок - объем падает (< 0.7)
            volumeDot.className = 'dot red';
            volumeDot.innerHTML = '';
            break;
          case 'short-strong':
            // Красный кружок - сильное падение объема (< 0.5)
            volumeDot.className = 'dot red';
            volumeDot.innerHTML = '';
            break;
          case 'caution':
            // Желтый кружок - осторожность (3.0-19.99)
            volumeDot.className = 'dot caution';
            volumeDot.innerHTML = '';
            break;
          case 'anomaly':
            // Красный крестик - аномалия (> 19.99)
            volumeDot.className = 'dot anomaly';
            volumeDot.innerHTML = '✕';
            break;
          case 'critical':
            // Красный крестик с надписью АНОМАЛИЯ (≥ 20.0)
            volumeDot.className = 'dot anomaly';
            volumeDot.innerHTML = '✕';
            break;
          default:
            // Серый кружок - стабильный объем (0.7-1.5)
            volumeDot.className = 'dot neutral';
            volumeDot.innerHTML = '';
        }
        
        // Обновляем значение Volume Ratio
        const volumeElement = document.getElementById(`volume-ratio-${symbol}`);
        if (volumeElement) {
          if (ratio !== null) {
            let displayText = ratio.toFixed(2);
            
            if (signal === 'critical') {
              displayText = 'АНОМАЛИЯ';
            } else if (analytics.volumeConfidence > 0) {
              displayText += ` (+${analytics.volumeConfidence}%)`;
            }
            
            volumeElement.textContent = displayText;
          } else {
            volumeElement.textContent = '--';
          }
        }
      }

      function updateRsiSignal(symbol, analytics) {
        const rsiDot = document.getElementById(`rsi-dot-${symbol}`);
        if (!rsiDot) return;
      
        const signal = analytics.rsiSignal || 'neutral';
        const rsi = analytics.rsi || 50;
        
        // RSI - квадратики (borderRadius: 2px)
        rsiDot.style.borderRadius = '2px';
        rsiDot.style.transform = 'none';
        
        // Обновляем цвет квадрата в зависимости от силы сигнала
        switch (signal) {
          case 'long-extreme':
            // Зелёный квадрат - экстремальная перепроданность (15-30)
            rsiDot.className = 'dot green';
            rsiDot.innerHTML = '';
            break;
          case 'long-strong':
            // Зелёный квадрат - сильная перепроданность (30-40)
            rsiDot.className = 'dot green';
            rsiDot.innerHTML = '';
            break;
          case 'long-weak':
            // Зелёный кружок - умеренная перепроданность (40-50)
            rsiDot.className = 'dot green';
            rsiDot.innerHTML = '';
            break;
          case 'short-weak':
            // Красный кружок - умеренная перекупленность (60-70)
            rsiDot.className = 'dot red';
            rsiDot.innerHTML = '';
            break;
          case 'short-strong':
            // Красный кружок - сильная перекупленность (70-80)
            rsiDot.className = 'dot red';
            rsiDot.innerHTML = '';
            break;
          case 'short-extreme':
            // Красный кружок - экстремальная перекупленность (80-100)
            rsiDot.className = 'dot red';
            rsiDot.innerHTML = '';
            break;
          default:
            // Серый кружок - нейтральная зона (50-60 и < 15)
            rsiDot.className = 'dot neutral';
            rsiDot.innerHTML = '';
        }
        
        // Обновляем значение RSI
        const rsiElement = document.getElementById(`rsi-${symbol}`);
        if (rsiElement) {
          let displayText = rsi.toFixed(2);
          
          if (analytics.rsiConfidence > 0) {
            displayText += ` (+${analytics.rsiConfidence}%)`;
          }
          
          rsiElement.textContent = displayText;
        }
      }

      function updateLiquiditySignal(symbol, analytics) {
        const liquidityDot = document.getElementById(`liquidity-dot-${symbol}`);
        if (!liquidityDot) return;
      
        const signal = analytics.liquiditySignal || 'neutral';
        const ratio = analytics.liquidityRatio;
        
        // Liquidity - ромбики (borderRadius: 2px + rotate 45deg)
        liquidityDot.style.borderRadius = '2px';
        liquidityDot.style.transform = 'rotate(45deg)';
        
        // Обновляем цвет ромба в зависимости от сигнала
        switch (signal) {
          case 'long':
            // Зелёный ромб - ликвидность растет (>= 1.15)
            liquidityDot.className = 'dot green';
            liquidityDot.innerHTML = '';
            break;
          case 'short':
            // Красный ромб - ликвидность падает (< 0.85)
            liquidityDot.className = 'dot red';
            liquidityDot.innerHTML = '';
            break;
          default:
            // Серый кружок - стабильная ликвидность (0.85-1.15)
            liquidityDot.className = 'dot neutral';
            liquidityDot.innerHTML = '';
        }
        
        // Обновляем значение Liquidity
        const liquidityElement = document.getElementById(`liquidity-${symbol}`);
        if (liquidityElement && analytics.orderBook) {
          const liq = analytics.orderBook.totalLiquidity;
          let displayText = liq >= 1000000 
            ? `$${(liq / 1000000).toFixed(2)}M` 
            : `$${(liq / 1000).toFixed(0)}k`;
          
          if (ratio !== null) {
            displayText += ` (${ratio.toFixed(2)})`;
          }
          
          if (analytics.liquidityConfidence > 0) {
            displayText += ` +${analytics.liquidityConfidence}%`;
          }
          
          liquidityElement.textContent = displayText;
        }
      }

      function updateMacdSignal(symbol, analytics) {
        const macdDot = document.getElementById(`macd-dot-${symbol}`);
        if (!macdDot) return;
      
        const signal = analytics.macdSignal || 'neutral';
        const confidence = analytics.macdConfidence || 0;
        
        // Обновляем цвет кружка в зависимости от сигнала
        switch (signal) {
          case 'long':
            // Зелёный кружок - MACD > Signal (momentum растет)
            macdDot.className = 'dot green';
            macdDot.innerHTML = '';
            break;
          case 'short':
            // Красный кружок - MACD < Signal (momentum падает)
            macdDot.className = 'dot red';
            macdDot.innerHTML = '';
            break;
          default:
            // Серый кружок - нейтральный сигнал
            macdDot.className = 'dot neutral';
            macdDot.innerHTML = '';
        }
      }

      function updateAtrSignal(symbol, analytics) {
        const atrDot = document.getElementById(`atr-dot-${symbol}`);
        if (!atrDot) {
          console.log(`ATR dot not found for ${symbol}`);
          return;
        }
      
        const signal = analytics.atrSignal || 'neutral';
        const confidence = analytics.atrConfidence || 0;
        
        console.log(`ATR ${symbol}: signal=${signal}, confidence=${confidence}, atr=${analytics.atr}`);
        
        // ATR - ромбики (borderRadius: 2px + rotate 45deg)
        atrDot.style.borderRadius = '2px';
        atrDot.style.transform = 'rotate(45deg)';
        
        // Обновляем цвет ромба в зависимости от сигнала
        switch (signal) {
          case 'long':
            // Зелёный ромб - ATR в диапазоне + EMA в LONG
            atrDot.className = 'dot green';
            atrDot.innerHTML = '';
            break;
          case 'short':
            // Красный ромб - ATR в диапазоне + EMA в SHORT
            atrDot.className = 'dot red';
            atrDot.innerHTML = '';
            break;
          default:
            // Серый ромб - ATR вне диапазона или EMA нейтральны
            atrDot.className = 'dot neutral';
            atrDot.innerHTML = '';
        }
        
        console.log(`ATR ${symbol} dot updated: ${signal} color`);
      }

    function updateIndicator(elementId, value, type) {
      const element = document.getElementById(elementId);
      if (!element || value === null || value === undefined) return;

      let formattedValue = '--';
      let cssClass = 'neutral';

      switch (type) {
        case 'price':
          formattedValue = `$${value.toFixed(4)}`;
          break;
        case 'rsi':
          formattedValue = value.toFixed(2);
          if (value > 70) cssClass = 'negative'; // Перекупленность
          else if (value < 30) cssClass = 'positive'; // Перепроданность
          else cssClass = 'neutral';
          break;
        case 'ratio':
          formattedValue = value.toFixed(2) + 'x';
          if (value > 1.2) cssClass = 'positive'; // Высокий объем
          else if (value < 0.8) cssClass = 'negative'; // Низкий объем
          else cssClass = 'neutral';
          break;
        case 'spread':
          formattedValue = value.toFixed(4) + '%';
          cssClass = value < 0.1 ? 'positive' : (value < 0.5 ? 'neutral' : 'negative');
          break;
        case 'liquidity':
          // Форматируем большие числа с разделителями тысяч и символом $
          if (value >= 1000000) {
            formattedValue = '$' + (value / 1000000).toFixed(1) + 'M';
          } else if (value >= 1000) {
            formattedValue = '$' + (value / 1000).toFixed(1) + 'K';
          } else {
            formattedValue = '$' + value.toFixed(0);
          }
          cssClass = 'neutral';
          break;
        case 'atr':
          // Специальная обработка для ATR с большей точностью
          formattedValue = value.toFixed(5);
          cssClass = 'neutral';
          break;
        case 'bid-ask-ratio': // Special case for Bid/Ask Ratio
          formattedValue = value.toFixed(2) + 'x';
          // Красный цвет для экстремальных значений (< 0.8 или > 2.0)
          if (value < 0.8 || value > 2.0) {
            cssClass = 'negative';
          } else {
            cssClass = 'neutral';
          }
          break;
        default:
          formattedValue = value.toFixed(4);
      }

      element.textContent = formattedValue;
      element.className = `indicator-value ${cssClass}`;
    }

    function updateSignalCard(symbol, data) {
      const analytics = data.analytics;
      const orderBook = data.orderBook;
      const spotPrice = data.spot.price;
      
      if (!analytics || !orderBook) return;

      console.log(`🎯 Calculating signal for ${symbol}:`, {
        ema9: analytics.ema9,
        ema21: analytics.ema21,
        ema50: analytics.ema50,
        rsi: analytics.rsi,
        macd: analytics.macd,
        volumeRatio: analytics.volumeRatio
      });

      // Расчет confidence для LONG
      let longScore = 0;

      // EMA структура (20 баллов)
      if (analytics.ema9 > analytics.ema21 && analytics.ema21 > analytics.ema50) {
        longScore += 20;
      }

      // MACD (15 баллов)
      if (analytics.macd && analytics.macd.macd > analytics.macd.signal && analytics.macd.histogram > 0) {
        longScore += 15;
      }

      // RSI (10 баллов)
      if (analytics.rsi >= 45 && analytics.rsi <= 70) {
        longScore += 10;
      } else if ((analytics.rsi >= 40 && analytics.rsi < 45) || (analytics.rsi > 70 && analytics.rsi <= 75)) {
        longScore += 5;
      }

      // Volume Ratio (15 баллов)
      if (analytics.volumeRatio >= 1.30) {
        longScore += 15;
      } else if (analytics.volumeRatio >= 1.00) {
        longScore += 8;
      }

      // Бонусы
      if (analytics.volumeRatio >= 1.50) {
        longScore += 10;
      }

      // Расчет confidence для SHORT
      let shortScore = 0;

      // EMA структура (20 баллов)
      if (analytics.ema9 < analytics.ema21 && analytics.ema21 < analytics.ema50) {
        shortScore += 20;
      }

      // MACD (15 баллов)
      if (analytics.macd && analytics.macd.macd < analytics.macd.signal && analytics.macd.histogram < 0) {
        shortScore += 15;
      }

      // RSI (10 баллов)
      if (analytics.rsi >= 25 && analytics.rsi <= 55) {
        shortScore += 10;
      } else if ((analytics.rsi >= 20 && analytics.rsi < 25) || (analytics.rsi > 55 && analytics.rsi <= 60)) {
        shortScore += 5;
      }

      // Volume Ratio (15 баллов)
      if (analytics.volumeRatio >= 1.40) {
        shortScore += 15;
      } else if (analytics.volumeRatio >= 1.10) {
        shortScore += 8;
      }

      // Бонусы
      if (analytics.volumeRatio >= 1.50) {
        shortScore += 10;
      }

      // Определяем сигнал
      let signal = 'HOLD';
      let confidence = 0;
      let tpPercent = 0;
      let slPercent = 0;

      console.log(`📊 ${symbol} Scores: LONG=${longScore}, SHORT=${shortScore}`);

      if (longScore >= 50) {
        signal = 'BUY';
        confidence = longScore;
        tpPercent = 0.25;
        slPercent = -0.13;
      } else if (shortScore >= 60) {
        signal = 'SELL';
        confidence = shortScore;
        tpPercent = -0.25;
        slPercent = 0.15;
      } else {
        confidence = Math.max(longScore, shortScore);
      }

      console.log(`🎯 ${symbol} Signal: ${signal}, Confidence: ${confidence}%`);

      // Рассчитываем уровни входа, TP, SL
      const entryPrice = spotPrice;
      const tpPrice = entryPrice * (1 + tpPercent / 100);
      const slPrice = entryPrice * (1 + slPercent / 100);
      const riskReward = Math.abs(tpPercent / slPercent);

      // Обновляем UI
      const badgeEl = document.getElementById(`signal-badge-${symbol}`);
      const confidenceValueEl = document.getElementById(`confidence-value-${symbol}`);
      const confidenceFillEl = document.getElementById(`confidence-fill-${symbol}`);
      const entryEl = document.getElementById(`entry-${symbol}`);
      const tpEl = document.getElementById(`tp-${symbol}`);
      const slEl = document.getElementById(`sl-${symbol}`);
      const rrEl = document.getElementById(`rr-${symbol}`);

      if (badgeEl) {
        badgeEl.textContent = signal;
        badgeEl.className = `signal-badge ${signal.toLowerCase()}`;
      }

      if (confidenceValueEl) {
        confidenceValueEl.textContent = `${confidence}%`;
      }

      if (confidenceFillEl) {
        confidenceFillEl.style.width = `${confidence}%`;
        if (confidence >= 70) {
          confidenceFillEl.className = 'confidence-fill high';
        } else if (confidence >= 40) {
          confidenceFillEl.className = 'confidence-fill medium';
        } else {
          confidenceFillEl.className = 'confidence-fill low';
        }
      }

      if (entryEl) {
        entryEl.textContent = `$${entryPrice.toFixed(4)}`;
      }

      if (tpEl && signal !== 'HOLD') {
        tpEl.textContent = `$${tpPrice.toFixed(4)} (${tpPercent > 0 ? '+' : ''}${tpPercent.toFixed(2)}%)`;
      }

      if (slEl && signal !== 'HOLD') {
        slEl.textContent = `$${slPrice.toFixed(4)} (${slPercent > 0 ? '+' : ''}${slPercent.toFixed(2)}%)`;
      }

      if (rrEl && signal !== 'HOLD') {
        rrEl.textContent = `1:${riskReward.toFixed(1)}`;
      }
    }

    ws.onopen = () => {
      console.log('✅ Подключено к серверу');
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      
      // Обновляем каждую криптовалюту
      Object.keys(data).forEach(symbol => {
        updateCryptoCard(symbol, data[symbol]);
        
        // Обновляем аналитику
        if (data[symbol].analytics || data[symbol].orderBook) {
          updateAnalyticsCard(symbol, data[symbol]);
        }

        // Обновляем торговые сигналы
        if (data[symbol].analytics && data[symbol].orderBook) {
          updateSignalCard(symbol, data[symbol]);
        }
      });
    };

    ws.onerror = (error) => {
      console.error('❌ Ошибка WebSocket:', error);
    };

    ws.onclose = () => {
      console.log('⚠️ Соединение закрыто');
      Object.keys(cryptoConfig).forEach(symbol => {
        const priceEl = document.getElementById(`price-${symbol}`);
        if (priceEl) priceEl.textContent = 'Переподключение...';
      });
    };
  </script>
</body>
</html>

