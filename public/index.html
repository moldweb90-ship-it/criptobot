<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Price Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      margin: 0 auto;
      margin-top: 15px;
      padding: 20px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .crypto-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
      margin: 30px auto 0;
    }

    .crypto-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 15px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
      min-height: 220px;
    }

    .crypto-card:hover {
      transform: translateY(-5px);
    }

    .header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      color: white;
    }

    .icon.btc { background: linear-gradient(135deg, #f7931a 0%, #ffa726 100%); }
    .icon.eth { background: linear-gradient(135deg, #627eea 0%, #8c9eff 100%); }
    .icon.sol { background: linear-gradient(135deg, #9945ff 0%, #14f195 100%); }
    .icon.xrp { background: linear-gradient(135deg, #23292f 0%, #4a90e2 100%); }
    .icon.bnb { background: linear-gradient(135deg, #f3ba2f 0%, #f7d794 100%); }
    .icon.doge { background: linear-gradient(135deg, #c2a633 0%, #d4c17d 100%); }

    .title {
      font-size: 14px;
      font-weight: 700;
      color: #2d3748;
    }

    .subtitle {
      font-size: 10px;
      color: #718096;
      margin-top: 2px;
    }

    .price-display {
      text-align: center;
      margin: 15px 0;
    }

    .price {
      font-size: 20px;
      font-weight: 800;
      color: #2d3748;
      margin-bottom: 4px;
      transition: all 0.3s ease;
    }

    .price.flash-green {
      animation: flashGreen 0.5s;
    }

    .price.flash-red {
      animation: flashRed 0.5s;
    }

    @keyframes flashGreen {
      0%, 100% { color: #2d3748; }
      50% { color: #48bb78; transform: scale(1.05); }
    }

    @keyframes flashRed {
      0%, 100% { color: #2d3748; }
      50% { color: #f56565; transform: scale(1.05); }
    }

    .change {
      font-size: 16px;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 12px;
      display: inline-block;
    }

    .change.positive {
      background: #c6f6d5;
      color: #22543d;
    }

    .change.negative {
      background: #fed7d7;
      color: #742a2a;
    }

    .spread {
      font-size: 16px;
      font-weight: 600;
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 12px;
      background: #e2e8f0;
      color: #4a5568;
    }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-top: 12px;
    }

    .stats .stat-item:nth-child(5),
    .stats .stat-item:nth-child(6) {
      grid-column: 1 / -1;
      font-size: 10px;
    }

    .stat-item {
      background: #f7fafc;
      padding: 10px;
      border-radius: 8px;
    }

    .stat-label {
      font-size: 10px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 3px;
    }

    .stat-value {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }

    .status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 20px;
      font-size: 14px;
      color: #718096;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #48bb78;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .loading {
      text-align: center;
      color: #718096;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */
    .analytics-section {
      margin-top: 40px;
      padding: 0 20px;
    }

    .analytics-title {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 30px;
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
      margin: 0 auto;
    }

    .analytics-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .analytics-card:hover {
      transform: translateY(-3px);
    }

    .analytics-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e2e8f0;
    }

    .analytics-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      color: white;
    }

    .analytics-name {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }

    .indicator {
      margin-bottom: 12px;
      padding: 8px;
      background: #f7fafc;
      border-radius: 8px;
    }

    .indicator-label {
      font-size: 11px;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 3px;
    }

    .indicator-value {
      font-size: 13px;
      font-weight: 600;
      color: #2d3748;
    }

    .indicator-value.positive {
      color: #48bb78;
    }

    .indicator-value.negative {
      color: #f56565;
    }

    .indicator-value.neutral {
      color: #718096;
    }

    .macd-values {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px;
      margin-top: 5px;
    }

    .macd-item {
      font-size: 10px;
      padding: 3px;
      background: #edf2f7;
      border-radius: 4px;
      text-align: center;
    }

    /* –°–µ–∫—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */
    .analytics-section {
      margin-top: 40px;
      padding: 20px;
      background: #f8fafc;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      width: 100%;
      clear: both;
    }

    .analytics-title {
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ 6 –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-width: 1200px) {
      .crypto-grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
      }
      .analytics-grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
      }
    }

    .analytics-card {
      background: white;
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .analytics-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .analytics-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f1f5f9;
    }

    .analytics-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .analytics-icon.btc { background: linear-gradient(135deg, #f7931a 0%, #ffa726 100%); }
    .analytics-icon.eth { background: linear-gradient(135deg, #627eea 0%, #8c9eff 100%); }
    .analytics-icon.sol { background: linear-gradient(135deg, #9945ff 0%, #14f195 100%); }
    .analytics-icon.xrp { background: linear-gradient(135deg, #23292f 0%, #4a90e2 100%); }
    .analytics-icon.bnb { background: linear-gradient(135deg, #f3ba2f 0%, #f7d794 100%); }
    .analytics-icon.doge { background: linear-gradient(135deg, #c2a633 0%, #d4c17d 100%); }

    .analytics-name {
      font-size: 14px;
      font-weight: 600;
      color: #2d3748;
    }

    .trend-indicators {
      margin-left: auto;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .trend-line {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .trend-label {
      font-size: 10px;
      font-weight: 700;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .trend-percentage {
      font-size: 12px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 4px;
      background: #e2e8f0;
      color: #4a5568;
      transition: all 0.3s ease;
    }

    .trend-percentage.long-active {
      background: #48bb78;
      color: white;
    }

    .trend-percentage.short-active {
      background: #f56565;
      color: white;
    }

    .indicator-label-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }

    .dot.green {
      background: #48bb78;
    }

    .dot.red {
      background: #f56565;
    }

    .dot.neutral {
      background: #e2e8f0;
    }

    .dot.yellow {
      background: #f6e05e;
    }

    .dot.blue {
      background: #4299e1;
    }

    .dot.orange {
      background: #ed8936;
    }

    .dot.red {
      background: #f56565;
    }

    .dot.maroon {
      background: #c53030;
    }

    .dot.volatile {
      background: #e53e3e;
      color: white;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      width: 16px;
      height: 16px;
      border: 2px solid #c53030;
    }

    .dot.caution {
      background: #f6e05e;
    }

    .dot.anomaly {
      background: #e53e3e;
      color: white;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      width: 16px;
      height: 16px;
      border: 2px solid #c53030;
    }

    .indicator-value-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .trend-indicator {
      font-size: 14px;
      font-weight: bold;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .trend-indicator.positive {
      background: #48bb78;
      color: white;
    }

    .trend-indicator.positive::after {
      content: '‚úì';
    }

    .trend-indicator.negative {
      background: #f56565;
      color: white;
    }

    .trend-indicator.negative::after {
      content: '‚Üì';
    }

    .trend-indicator.neutral {
      background: #e2e8f0;
      color: #718096;
    }

    .trend-indicator.neutral::after {
      content: '--';
      font-size: 10px;
    }

    .indicator {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      padding: 6px 10px;
      background: #f8fafc;
      border-radius: 6px;
      border-left: 3px solid #e2e8f0;
      transition: all 0.2s ease;
    }

    .indicator:hover {
      background: #f1f5f9;
      border-left-color: #4299e1;
    }

    .indicator.liquidity {
      min-width: 200px;
      flex-wrap: wrap;
    }
    
    .indicator.liquidity .indicator-value {
      font-size: 11px;
      min-width: 120px;
      text-align: right;
    }

    .indicator-label {
      font-size: 11px;
      font-weight: 500;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .indicator-value {
      font-size: 12px;
      font-weight: 600;
      padding: 3px 6px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .indicator-value.positive {
      color: #38a169;
      background: #f0fff4;
      border: 1px solid #c6f6d5;
    }

    .indicator-value.negative {
      color: #e53e3e;
      background: #fff5f5;
      border: 1px solid #fed7d7;
    }

    .indicator-value.neutral {
      color: #718096;
      background: #f7fafc;
      border: 1px solid #e2e8f0;
    }



    /* –°–µ–∫—Ü–∏—è —Å–¥–µ–ª–æ–∫ */
    .deals-section {
      margin-bottom: 40px;
      display: flex;
      gap: 20px;
      width: 100%;
    }

    /* –û—Ç–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏ (—Å–ª–µ–≤–∞) */
    .open-deals-container {
      flex: 1;
      width: 50%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .open-deals-title {
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 25px;
      text-align: center;
    }

    .open-deals-content {
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #a0aec0;
      font-size: 16px;
    }

    /* –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–¥–µ–ª–∫–∏ (—Å–ø—Ä–∞–≤–∞) */
    .deal-prep-container {
      flex: 1;
      width: 50%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .deal-prep-title {
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 25px;
      text-align: center;
    }

    .deal-prep-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .deal-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .deal-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }

    .deal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .deal-symbol {
      font-size: 18px;
      font-weight: 600;
      color: #2d3748;
    }

    .deal-match-count {
      font-size: 16px;
      font-weight: 600;
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 6px;
    }

    .deal-action-row {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
    }

    .deal-action {
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .deal-action.buy {
      background: #48bb78;
      color: white;
    }

    .deal-action.sell {
      background: #f56565;
      color: white;
    }

    .deal-timer {
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 15px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .deal-timer.fast-timer {
      background: #48bb78;
    }
    
    .deal-timer.standard-timer {
      background: #667eea;
    }

    .timer-value {
      font-size: 16px;
      font-weight: 700;
      color: white;
      font-family: 'Courier New', monospace;
    }

    .deal-confidence {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
    }

    .confidence-left {
      flex: 1;
    }

    .confidence-label {
      font-size: 12px;
      color: #718096;
      margin-bottom: 8px;
    }

    .confidence-bar {
      width: 100%;
      height: 12px;
      background: #e2e8f0;
      border-radius: 6px;
      overflow: hidden;
    }

    .confidence-percent {
      font-size: 18px;
      font-weight: 800;
      color: #2d3748;
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 50px;
    }

    .confidence-fill {
      height: 100%;
      border-radius: 6px;
      transition: width 0.3s ease;
    }
    
    .confidence-fill.high {
      background: linear-gradient(90deg, #48bb78, #68d391);
    }
    
    .confidence-fill.medium {
      background: linear-gradient(90deg, #f6ad55, #ed8936);
    }
    
    .confidence-fill.low {
      background: linear-gradient(90deg, #f56565, #e53e3e);
    }

    .confidence-percent {
      font-size: 18px;
      font-weight: 800;
      color: #2d3748;
      white-space: nowrap;
    }

    .deal-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .metric {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f7fafc;
    }

    .metric:last-child {
      border-bottom: none;
    }

    .metric-label {
      font-size: 12px;
      color: #718096;
    }

    .metric-value {
      font-size: 12px;
      font-weight: 600;
      color: #2d3748;
    }

    .metric-value.positive {
      color: #48bb78;
    }

    .metric-value.negative {
      color: #f56565;
    }

    .metric-value.neutral {
      color: #a0aec0;
    }

    .market-title {
      text-align: center;
      color: white;
      font-size: 24px;
      margin-bottom: 20px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      letter-spacing: 1px;
    }

    .analytics-title {
      text-align: center;
      color: #2d3748;
      font-size: 24px;
      margin-bottom: 20px;
      text-shadow: none;
      letter-spacing: 1px;
    }

    .market-section {
      margin-top: 30px;
      width: 100%;
    }

    .positions-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 20px;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #718096;
      font-size: 16px;
    }

    .signals-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }




    /* –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é */
    .top-menu {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      padding: 8px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      height: 60px;
    }

    .menu-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: #f8fafc;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      color: #2d3748;
      border: 1px solid #e2e8f0;
    }

    .menu-label {
      color: #718096;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .menu-value {
      color: #2d3748;
      font-size: 13px;
      font-weight: 700;
    }

    .menu-value.positive {
      color: #48bb78;
    }

    .menu-value.negative {
      color: #f56565;
    }

    .menu-balance {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .menu-balance .menu-label {
      color: rgba(255, 255, 255, 0.9);
    }

    .menu-balance .balance-value {
      color: white;
      font-size: 16px;
      font-weight: 800;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .menu-in-deals {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      border: none;
      box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
    }

    .menu-in-deals .menu-label {
      color: rgba(255, 255, 255, 0.9);
    }

    .menu-in-deals .deals-value {
      color: white;
      font-size: 16px;
      font-weight: 800;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .menu-pnl {
      background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
      border: none;
      box-shadow: 0 4px 15px rgba(66, 153, 225, 0.4);
      transition: all 0.3s ease;
    }

    .menu-pnl.positive {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
    }

    .menu-pnl.negative {
      background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
      box-shadow: 0 4px 15px rgba(245, 101, 101, 0.4);
    }

    .menu-pnl .menu-label {
      color: rgba(255, 255, 255, 0.9);
    }

    .menu-pnl .pnl-value {
      color: white;
      font-size: 16px;
      font-weight: 800;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    body {
      padding-top: 70px;
    }

    /* –í—ã–ø–∞–¥–∞—é—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
    .menu-stats-toggle {
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
    }

    .menu-stats-toggle:hover {
      transform: translateY(-2px);
    }

    .stats-dropdown {
      position: absolute;
      top: calc(100% + 10px);
      right: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      padding: 20px;
      min-width: 320px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1001;
    }

    .stats-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .stats-dropdown-title {
      font-size: 16px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 10px;
    }

    .stats-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #f7fafc;
    }

    .stats-item:last-child {
      border-bottom: none;
    }

    .stats-item-label {
      font-size: 13px;
      color: #718096;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stats-item-value {
      font-size: 14px;
      font-weight: 700;
      color: #2d3748;
    }

    .stats-item-value.positive {
      color: #48bb78;
    }

    .stats-item-value.negative {
      color: #f56565;
    }

    .stats-item-value.neutral {
      color: #4299e1;
    }

    .stats-toggle-icon {
      font-size: 12px;
      transition: transform 0.3s ease;
    }

    .stats-toggle-icon.open {
      transform: rotate(180deg);
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      width: 90%;
      max-width: 900px;
      max-height: 85vh;
      overflow: hidden;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .modal-overlay.show .modal-content {
      transform: scale(1);
    }

    .modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 25px 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: white;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .modal-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 30px;
      max-height: calc(85vh - 200px);
      overflow-y: auto;
    }

    .deals-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
    }

    .deals-table th {
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 10px 15px;
      background: #f7fafc;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .deals-table td {
      padding: 15px;
      background: white;
      border-top: 1px solid #e2e8f0;
      border-bottom: 1px solid #e2e8f0;
    }

    .deals-table tr {
      transition: all 0.2s ease;
    }

    .deals-table tbody tr:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .deals-table td:first-child {
      border-left: 1px solid #e2e8f0;
      border-radius: 10px 0 0 10px;
    }

    .deals-table td:last-child {
      border-right: 1px solid #e2e8f0;
      border-radius: 0 10px 10px 0;
    }

    .deal-symbol {
      font-weight: 700;
      color: #2d3748;
      font-size: 14px;
    }

    .deal-direction {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .deal-direction.long {
      background: #c6f6d5;
      color: #22543d;
    }

    .deal-direction.short {
      background: #fed7d7;
      color: #742a2a;
    }

    .deal-pnl {
      font-weight: 700;
      font-size: 14px;
    }

    .deal-pnl.positive {
      color: #48bb78;
    }

    .deal-pnl.negative {
      color: #f56565;
    }

    .modal-footer {
      padding: 20px 30px;
      background: #f7fafc;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-top: 1px solid #e2e8f0;
    }

    .pagination {
      display: flex;
      gap: 5px;
      align-items: center;
    }

    .pagination-btn {
      background: white;
      border: 1px solid #e2e8f0;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: #4a5568;
      transition: all 0.2s ease;
    }

    .pagination-btn:hover:not(:disabled) {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .pagination-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .pagination-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .pagination-info {
      font-size: 13px;
      color: #718096;
      font-weight: 600;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #a0aec0;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 18px;
      font-weight: 600;
      color: #718096;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
    .menu-stats-toggle {
      background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
      border: none;
      box-shadow: 0 4px 15px rgba(66, 153, 225, 0.4);
    }

    .menu-stats-toggle .menu-label,
    .menu-stats-toggle .menu-value {
      color: rgba(255, 255, 255, 0.9);
    }

    .menu-stats-toggle .stats-toggle-icon {
      color: white;
    }

    .stats-dropdown {
      background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
      border: 2px solid #e2e8f0;
    }

    .stats-item {
      transition: all 0.2s ease;
    }

    .stats-item:hover {
      background: #f7fafc;
      border-radius: 8px;
      padding-left: 10px;
    }

    /* Toggle –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å AUTO/MANUAL */
    .toggle-container {
      display: flex;
      align-items: center;
      gap: 8px;
      background: white;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
    }

    .toggle-label {
      font-size: 10px;
      font-weight: 600;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 24px;
      background: #e2e8f0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .toggle-switch.active {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    }

    .toggle-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch.active .toggle-slider {
      left: 28px;
    }

    .toggle-status {
      font-size: 11px;
      font-weight: 700;
      min-width: 60px;
    }

    .toggle-status.manual {
      color: #718096;
    }

    .toggle-status.auto {
      color: #48bb78;
    }

    /* –¢–∞–π–º–µ—Ä –¥–æ —Å–≤–µ—á–∏ */
    .timer-item {
      background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
      border: none;
      box-shadow: 0 4px 15px rgba(245, 101, 101, 0.4);
    }

    .timer-item .menu-label,
    .timer-item .menu-value {
      color: rgba(255, 255, 255, 0.9);
    }

    .timer-value {
      color: white;
      font-size: 16px;
      font-weight: 800;
      font-family: 'Courier New', monospace;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è */
    .today-stats {
      background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
      border: none;
      box-shadow: 0 4px 15px rgba(237, 137, 54, 0.4);
    }

    .today-stats .menu-label {
      color: rgba(255, 255, 255, 0.9);
    }

    .today-stats .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .today-stats .stat-mini {
      text-align: center;
    }

    .today-stats .stat-mini-label {
      font-size: 9px;
      color: rgba(255, 255, 255, 0.8);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .today-stats .stat-mini-value {
      font-size: 12px;
      font-weight: 800;
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
    .theme-toggle {
      cursor: pointer;
      background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(45, 55, 72, 0.4);
    }

    .theme-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(45, 55, 72, 0.6);
    }

    /* Dark theme */
    body.dark-theme {
      background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    }

    body.dark-theme .crypto-card,
    body.dark-theme .analytics-card,
    body.dark-theme .deal-card,
    body.dark-theme .open-deals-container,
    body.dark-theme .deal-prep-container {
      background: rgba(45, 55, 72, 0.95);
      color: #e2e8f0;
    }

    body.dark-theme .title,
    body.dark-theme .analytics-name,
    body.dark-theme .deal-symbol,
    body.dark-theme .stat-value,
    body.dark-theme .indicator-value {
      color: #e2e8f0;
    }

    body.dark-theme .subtitle,
    body.dark-theme .stat-label,
    body.dark-theme .indicator-label {
      color: #a0aec0;
    }

    body.dark-theme .top-menu {
      background: rgba(45, 55, 72, 0.98);
    }

    body.dark-theme .menu-item {
      background: #2d3748;
      border-color: #4a5568;
    }

    body.dark-theme .toggle-container {
      background: #2d3748;
      border-color: #4a5568;
    }

    body.dark-theme .modal-content {
      background: #2d3748;
      color: #e2e8f0;
    }

    body.dark-theme .deals-table th {
      background: #1a202c;
      color: #a0aec0;
    }

    body.dark-theme .deals-table td {
      background: #2d3748;
      border-color: #4a5568;
      color: #e2e8f0;
    }

  </style>
</head>
<body>
  <!-- –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é -->
  <div class="top-menu">
    <div class="menu-section">
      <div class="menu-item menu-balance">
        <span style="font-size: 20px;">üí∞</span>
        <div style="display: flex; flex-direction: column; gap: 2px;">
          <span class="menu-label">–ë–∞–ª–∞–Ω—Å</span>
          <span class="menu-value balance-value" id="menu-balance">$1,000.00</span>
        </div>
      </div>
      <div class="menu-item menu-in-deals">
        <span style="font-size: 20px;">üìä</span>
        <div style="display: flex; flex-direction: column; gap: 2px;">
          <span class="menu-label">–í —Å–¥–µ–ª–∫–∞—Ö</span>
          <span class="menu-value deals-value" id="menu-in-deals">$0.00</span>
        </div>
      </div>
      <div class="menu-item menu-pnl">
        <span style="font-size: 20px;">üìà</span>
        <div style="display: flex; flex-direction: column; gap: 2px;">
          <span class="menu-label">–û–±—â–∏–π PnL</span>
          <span class="menu-value pnl-value" id="menu-pnl">+$0.00 (0.00%)</span>
        </div>
      </div>
    </div>
    
    <div class="menu-section">
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å AUTO/MANUAL -->
      <div class="toggle-container">
        <span class="toggle-label">ü§ñ –†–µ–∂–∏–º:</span>
        <div class="toggle-switch" id="auto-toggle">
          <div class="toggle-slider"></div>
        </div>
        <span class="toggle-status manual" id="toggle-status">MANUAL</span>
      </div>
      
      <!-- –¢–∞–π–º–µ—Ä –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Å–≤–µ—á–∏ -->
      <div class="menu-item timer-item">
        <span style="font-size: 18px;">‚è±Ô∏è</span>
        <div style="display: flex; flex-direction: column; gap: 2px;">
          <span class="menu-label">–î–æ —Å–≤–µ—á–∏</span>
          <span class="timer-value" id="candle-timer">--:--</span>
        </div>
      </div>
      
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è -->
      <div class="menu-item today-stats">
        <div style="display: flex; flex-direction: column; gap: 2px; width: 100%;">
          <span class="menu-label">üìä –°–µ–≥–æ–¥–Ω—è</span>
          <div class="stats-grid">
            <div class="stat-mini">
              <div class="stat-mini-label">–°–¥–µ–ª–æ–∫</div>
              <div class="stat-mini-value" id="today-deals">0</div>
            </div>
            <div class="stat-mini">
              <div class="stat-mini-label">WR</div>
              <div class="stat-mini-value" id="today-wr">0%</div>
            </div>
            <div class="stat-mini">
              <div class="stat-mini-label">PnL</div>
              <div class="stat-mini-value" id="today-pnl">$0</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="menu-item menu-stats-toggle" id="stats-toggle">
        <span style="font-size: 18px;">üìä</span>
        <div style="display: flex; flex-direction: column; gap: 2px;">
          <span class="menu-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
          <span class="menu-value" style="font-size: 12px;">
            <span class="stats-toggle-icon" id="stats-icon">‚ñº</span>
          </span>
        </div>
        
        <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
        <div class="stats-dropdown" id="stats-dropdown">
          <div class="stats-dropdown-title">
            üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
          </div>
          
          <div class="stats-item">
            <div class="stats-item-label">üìã –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>
            <div class="stats-item-value neutral" id="stat-total-deals">0</div>
          </div>
          
          <div class="stats-item">
            <div class="stats-item-label">‚úÖ –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö</div>
            <div class="stats-item-value positive" id="stat-profitable">0 (0%)</div>
          </div>
          
          <div class="stats-item">
            <div class="stats-item-label">‚ùå –£–±—ã—Ç–æ—á–Ω—ã—Ö</div>
            <div class="stats-item-value negative" id="stat-losses">0 (0%)</div>
          </div>
          
          <div class="stats-item">
            <div class="stats-item-label">üìà –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ñ–∏—Ç</div>
            <div class="stats-item-value positive" id="stat-avg-profit">+$0.00</div>
          </div>
          
          <div class="stats-item">
            <div class="stats-item-label">üìâ –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫</div>
            <div class="stats-item-value negative" id="stat-avg-loss">-$0.00</div>
          </div>
          
          <div class="stats-item">
            <div class="stats-item-label">‚öñÔ∏è R/R Ratio</div>
            <div class="stats-item-value" id="stat-rr-ratio">0.00</div>
          </div>
          
          <div class="stats-item">
            <div class="stats-item-label">üí° Expectancy</div>
            <div class="stats-item-value" id="stat-expectancy">+$0.00</div>
          </div>
        </div>
      </div>
      
      <div class="menu-item" id="history-toggle" style="cursor: pointer; transition: all 0.3s ease;">
        <span style="font-size: 18px;">üìú</span>
        <span style="font-size: 13px; font-weight: 600; color: #2d3748;">–ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫</span>
      </div>
      
      <div class="menu-item">
        <div class="status-dot"></div>
        <span id="menu-status">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
      </div>
      
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
      <div class="theme-toggle" id="theme-toggle" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
        <span id="theme-icon">üåô</span>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫ -->
  <div class="modal-overlay" id="history-modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <span>üìú</span>
          <span>–ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫</span>
        </div>
        <button class="modal-close" id="modal-close">‚úï</button>
      </div>
      
      <div class="modal-body" id="modal-body">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
      </div>
      
      <div class="modal-footer">
        <div class="pagination-info" id="pagination-info">–ü–æ–∫–∞–∑–∞–Ω–æ 0-0 –∏–∑ 0</div>
        <div class="pagination" id="pagination">
          <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- –°–µ–∫—Ü–∏—è —Å–¥–µ–ª–æ–∫ -->
    <div class="deals-section">
      <!-- –û—Ç–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏ (—Å–ª–µ–≤–∞) -->
      <div class="open-deals-container">
        <h2 class="open-deals-title">–û—Ç–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏</h2>
        <div class="open-deals-content">
          <!-- –û—Ç–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>
      
      <!-- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–¥–µ–ª–∫–∏ (—Å–ø—Ä–∞–≤–∞) -->
      <div class="deal-prep-container">
        <h2 class="deal-prep-title">üéØ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–¥–µ–ª–∫–∏</h2>
        <div class="deal-prep-grid" id="dealPrepGrid">
          <!-- –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>
    </div>

    <!-- –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
    <div class="market-section">
      <h2 class="market-title">üí∞ –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
      <div class="crypto-grid" id="cryptoGrid">
        <!-- –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
      </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
    <div class="analytics-section">
        <h2 class="analytics-title">üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (15m)</h2>
      <div class="analytics-grid" id="analyticsGrid">
        <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
      </div>
    </div>
  </div>

  <script>
    const ws = new WebSocket('ws://localhost:5000');
    const cryptoGrid = document.getElementById('cryptoGrid');
    const analyticsGrid = document.getElementById('analyticsGrid');
    const dealPrepGrid = document.getElementById('dealPrepGrid');
    const lastPrices = {};
    let dealPrepData = {}; // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å–¥–µ–ª–æ–∫
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function loadDealPrepData() {
      const saved = localStorage.getItem('dealPrepData');
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã (–Ω–µ –∏—Å—Ç–µ–∫—à–∏–µ)
          const now = Date.now();
          Object.keys(parsed).forEach(symbol => {
            const deal = parsed[symbol];
            if (deal && deal.timestamp) {
              const elapsed = Math.floor((now - deal.timestamp) / 1000);
              const remaining = deal.timerSeconds - elapsed;
              if (remaining > 0) {
                dealPrepData[symbol] = {
                  ...deal,
                  timerSeconds: remaining
                };
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
                createOrUpdateDealCard(symbol, dealPrepData[symbol]);
                
                // –ö–ª–∞—Å—Å —Ç–∞–π–º–µ—Ä–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
              }
            }
          });
        } catch (e) {
          console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫:', e);
        }
      }
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
    function saveDealPrepData() {
      try {
        localStorage.setItem('dealPrepData', JSON.stringify(dealPrepData));
      } catch (e) {
        console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫:', e);
      }
    }
    
    // ============================================
    // –°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ —Å–¥–µ–ª–æ–∫ –∏ –±–∞–ª–∞–Ω—Å–∞
    // ============================================
    let initialBalance = 1000; // –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
    let currentBalance = 1000; // –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å (—Å —É—á–µ—Ç–æ–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π)
    let realizedPnL = 0; // –ü—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫ –æ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫
    let openPositions = []; // –ú–∞—Å—Å–∏–≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
    let closedDeals = []; // –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫
    let isAutoTradingEnabled = false; // –†–µ–∂–∏–º –∞–≤—Ç–æ—Ç–æ—Ä–≥–æ–≤–ª–∏
    let isDarkTheme = false; // –¢–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    
    // –†–∞—Å—á–µ—Ç –Ω–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ PnL (–æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏)
    function calculateUnrealizedPnL() {
      return openPositions.reduce((total, position) => {
        const priceDiff = position.direction === 'LONG' 
          ? (position.currentPrice - position.entryPrice)
          : (position.entryPrice - position.currentPrice);
        
        return total + (priceDiff * position.volume);
      }, 0);
    }
    
    // –†–∞—Å—á–µ—Ç –æ–±—â–µ–≥–æ PnL
    function calculateTotalPnL() {
      const unrealizedPnL = calculateUnrealizedPnL();
      const totalPnL = realizedPnL + unrealizedPnL;
      const roi = (totalPnL / initialBalance) * 100;
      
      return { 
        totalPnL, 
        roi, 
        realizedPnL, 
        unrealizedPnL 
      };
    }
    
    // –†–∞—Å—á–µ—Ç —Å—É–º–º—ã –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–∫–∞—Ö
    function calculateInDeals() {
      return openPositions.reduce((sum, pos) => sum + pos.amountUSD, 0);
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏ PnL
    function updateBalanceDisplay() {
      const pnl = calculateTotalPnL();
      const inDeals = calculateInDeals();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
      document.getElementById('menu-balance').textContent = 
        `$${currentBalance.toFixed(2)}`;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É–º–º—É –≤ —Å–¥–µ–ª–∫–∞—Ö
      document.getElementById('menu-in-deals').textContent = 
        `$${inDeals.toFixed(2)}`;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º PnL
      const sign = pnl.totalPnL >= 0 ? '+' : '';
      const pnlElement = document.getElementById('menu-pnl');
      const pnlContainer = pnlElement.closest('.menu-pnl');
      
      pnlElement.textContent = 
        `${sign}$${pnl.totalPnL.toFixed(2)} (${sign}${pnl.roi.toFixed(2)}%)`;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç PnL
      pnlContainer.classList.remove('positive', 'negative');
      if (pnl.totalPnL > 0) {
        pnlContainer.classList.add('positive');
      } else if (pnl.totalPnL < 0) {
        pnlContainer.classList.add('negative');
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–æ—Ä–≥–æ–≤–ª–∏
      updateTradingStats();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —Å–µ–≥–æ–¥–Ω—è
      updateTodayStats();
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏
    function updateTradingStats() {
      const totalDeals = closedDeals.length;
      const profitableDeals = closedDeals.filter(d => d.realizedPnL > 0);
      const losingDeals = closedDeals.filter(d => d.realizedPnL < 0);
      
      const winRate = totalDeals > 0 ? (profitableDeals.length / totalDeals * 100) : 0;
      const lossRate = totalDeals > 0 ? (losingDeals.length / totalDeals * 100) : 0;
      
      const avgProfit = profitableDeals.length > 0
        ? profitableDeals.reduce((sum, d) => sum + d.realizedPnL, 0) / profitableDeals.length
        : 0;
      
      const avgLoss = losingDeals.length > 0
        ? losingDeals.reduce((sum, d) => sum + d.realizedPnL, 0) / losingDeals.length
        : 0;
      
      const rrRatio = avgLoss !== 0 ? Math.abs(avgProfit / avgLoss) : 0;
      const expectancy = totalDeals > 0 ? realizedPnL / totalDeals : 0;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º UI
      document.getElementById('stat-total-deals').textContent = totalDeals;
      
      document.getElementById('stat-profitable').textContent = 
        `${profitableDeals.length} (${winRate.toFixed(0)}%)`;
      
      document.getElementById('stat-losses').textContent = 
        `${losingDeals.length} (${lossRate.toFixed(0)}%)`;
      
      document.getElementById('stat-avg-profit').textContent = 
        `+$${avgProfit.toFixed(2)}`;
      
      document.getElementById('stat-avg-loss').textContent = 
        `${avgLoss.toFixed(2) === '0.00' ? '-$0.00' : '$' + avgLoss.toFixed(2)}`;
      
      const rrElement = document.getElementById('stat-rr-ratio');
      rrElement.textContent = rrRatio.toFixed(2);
      rrElement.className = 'stats-item-value';
      if (rrRatio >= 2) {
        rrElement.classList.add('positive');
      } else if (rrRatio >= 1) {
        rrElement.classList.add('neutral');
      } else {
        rrElement.classList.add('negative');
      }
      
      const expElement = document.getElementById('stat-expectancy');
      const expSign = expectancy >= 0 ? '+' : '';
      expElement.textContent = `${expSign}$${expectancy.toFixed(2)}`;
      expElement.className = 'stats-item-value';
      if (expectancy > 0) {
        expElement.classList.add('positive');
      } else if (expectancy < 0) {
        expElement.classList.add('negative');
      } else {
        expElement.classList.add('neutral');
      }
    }
    
    // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    function openPosition(symbol, direction, entryPrice, volume) {
      const position = {
        id: Date.now(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
        symbol: symbol,
        direction: direction, // 'LONG' –∏–ª–∏ 'SHORT'
        entryPrice: entryPrice,
        volume: volume,
        amountUSD: entryPrice * volume,
        openTime: Date.now(),
        currentPrice: entryPrice,
        unrealizedPnL: 0
      };
      
      openPositions.push(position);
      currentBalance -= position.amountUSD; // –í—ã—á–∏—Ç–∞–µ–º –∏–∑ –±–∞–ª–∞–Ω—Å–∞
      
      console.log(`üìà –û—Ç–∫—Ä—ã—Ç–∞ –ø–æ–∑–∏—Ü–∏—è: ${direction} ${symbol} @ $${entryPrice.toFixed(2)}, Volume: ${volume}`);
      
      updateBalanceDisplay();
      return position;
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    function closePosition(positionIndex, exitPrice) {
      const position = openPositions[positionIndex];
      
      if (!position) {
        console.error('‚ùå –ü–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return null;
      }
      
      const priceDiff = position.direction === 'LONG'
        ? (exitPrice - position.entryPrice)
        : (position.entryPrice - exitPrice);
      
      const profit = priceDiff * position.volume;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å—ã
      realizedPnL += profit;
      currentBalance += position.amountUSD + profit;
      
      // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ –∑–∞–∫—Ä—ã—Ç–æ–π —Å–¥–µ–ª–∫–µ
      const closedDeal = {
        ...position,
        exitPrice: exitPrice,
        closeTime: Date.now(),
        duration: Date.now() - position.openTime,
        realizedPnL: profit,
        profitPercent: (profit / position.amountUSD) * 100
      };
      
      closedDeals.push(closedDeal);
      openPositions.splice(positionIndex, 1);
      
      console.log(`üìâ –ó–∞–∫—Ä—ã—Ç–∞ –ø–æ–∑–∏—Ü–∏—è: ${position.direction} ${position.symbol} @ $${exitPrice.toFixed(2)}, PnL: ${profit >= 0 ? '+' : ''}$${profit.toFixed(2)}`);
      
      updateBalanceDisplay();
      return closedDeal;
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö —Ü–µ–Ω –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
    function updateOpenPositionsPrices(data) {
      openPositions.forEach(position => {
        if (data[position.symbol] && data[position.symbol].futures) {
          position.currentPrice = data[position.symbol].futures.price;
          
          // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º unrealized PnL
          const priceDiff = position.direction === 'LONG' 
            ? (position.currentPrice - position.entryPrice)
            : (position.entryPrice - position.currentPrice);
          
          position.unrealizedPnL = priceDiff * position.volume;
        }
      });
    }
    // ============================================
    
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
    const cryptoConfig = {
      'BTCUSDT': { name: 'Bitcoin', symbol: '‚Çø', class: 'btc' },
      'ETHUSDT': { name: 'Ethereum', symbol: 'Œû', class: 'eth' },
      'SOLUSDT': { name: 'Solana', symbol: '‚óé', class: 'sol' },
      'XRPUSDT': { name: 'Ripple', symbol: '‚úï', class: 'xrp' },
      'BNBUSDT': { name: 'BNB', symbol: 'B', class: 'bnb' },
      'DOGEUSDT': { name: 'Dogecoin', symbol: '√ê', class: 'doge' }
    };

    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
    Object.keys(cryptoConfig).forEach(symbol => {
      const config = cryptoConfig[symbol];
      const card = createCryptoCard(symbol, config);
      cryptoGrid.appendChild(card);
      
      // –°–æ–∑–¥–∞–µ–º –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é –∫–∞—Ä—Ç–æ—á–∫—É
      const analyticsCard = createAnalyticsCard(symbol, config);
      analyticsGrid.appendChild(analyticsCard);

    });

    function createCryptoCard(symbol, config) {
      const card = document.createElement('div');
      card.className = 'crypto-card';
      card.id = `card-${symbol}`;
      
      card.innerHTML = `
        <div class="header">
          <div class="icon ${config.class}">${config.symbol}</div>
          <div>
            <div class="title">${config.name}</div>
            <div class="subtitle">${symbol}/USDT Futures</div>
          </div>
        </div>

        <div class="price-display">
          <div class="price" id="price-${symbol}">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
          <div class="change" id="change-${symbol}">--</div>
        </div>

        <div class="stats">
          <div class="stat-item">
            <div class="stat-label">–ú–∞–∫—Å–∏–º—É–º 24—á</div>
            <div class="stat-value" id="high-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–ú–∏–Ω–∏–º—É–º 24—á</div>
            <div class="stat-value" id="low-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–û–±—ä–µ–º 24—á</div>
            <div class="stat-value" id="volume-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–û–±–Ω–æ–≤–ª–µ–Ω–æ</div>
            <div class="stat-value" id="time-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
            <div class="stat-value" id="precision-${symbol}">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Raw Data</div>
            <div class="stat-value" id="raw-${symbol}">--</div>
          </div>
        </div>

        <div class="status">
          <div class="status-dot"></div>
          <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Binance Futures</span>
        </div>
      `;
      
      return card;
    }

    function createAnalyticsCard(symbol, config) {
      const card = document.createElement('div');
      card.className = 'analytics-card';
      card.id = `analytics-${symbol}`;
      
      card.innerHTML = `
        <div class="analytics-header">
          <div class="analytics-icon ${config.class}">${config.symbol}</div>
          <div class="analytics-name">${config.name}</div>
          <div class="trend-indicators">
            <div class="trend-line">
              <span class="trend-label">LONG:</span>
              <span class="trend-percentage" id="long-percentage-${symbol}">0%</span>
            </div>
            <div class="trend-line">
              <span class="trend-label">SHORT:</span>
              <span class="trend-percentage" id="short-percentage-${symbol}">0%</span>
            </div>
          </div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="dot1-${symbol}"></div>
          <div class="indicator-label">EMA 9</div>
          </div>
          <div class="indicator-value" id="ema9-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="dot2-${symbol}"></div>
          <div class="indicator-label">EMA 21</div>
          </div>
          <div class="indicator-value" id="ema21-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="dot3-${symbol}"></div>
          <div class="indicator-label">EMA 50</div>
          </div>
          <div class="indicator-value" id="ema50-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="rsi-dot-${symbol}"></div>
          <div class="indicator-label">RSI (14)</div>
          </div>
          <div class="indicator-value" id="rsi-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="macd-dot-${symbol}"></div>
          <div class="indicator-label">MACD</div>
          </div>
          <div class="indicator-value" id="macd-${symbol}">--</div>
          <div class="macd-values" id="macd-details-${symbol}">
            <div class="macd-item">Signal: --</div>
            <div class="macd-item">Hist: --</div>
          </div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="atr-dot-${symbol}"></div>
          <div class="indicator-label">ATR (14)</div>
          </div>
          <div class="indicator-value" id="atr-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="volume-dot-${symbol}"></div>
          <div class="indicator-label">Volume Ratio</div>
          </div>
          <div class="indicator-value" id="volume-ratio-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="spread-dot-${symbol}"></div>
          <div class="indicator-label">Spread</div>
          </div>
          <div class="indicator-value" id="spread-${symbol}">--</div>
        </div>
        
        <div class="indicator liquidity">
          <div class="indicator-label-container">
            <div class="dot neutral" id="liquidity-dot-${symbol}"></div>
          <div class="indicator-label">Liquidity (¬±0.10%)</div>
          </div>
          <div class="indicator-value" id="liquidity-${symbol}">--</div>
        </div>
        
        <div class="indicator">
          <div class="indicator-label-container">
            <div class="dot neutral" id="bid-ask-dot-${symbol}"></div>
          <div class="indicator-label">Bid/Ask Ratio</div>
          </div>
          <div class="indicator-value" id="bid-ask-ratio-${symbol}">--</div>
        </div>
      `;
      
      return card;
    }


    function updateCryptoCard(symbol, data) {
      const priceEl = document.getElementById(`price-${symbol}`);
      const changeEl = document.getElementById(`change-${symbol}`);
      const highEl = document.getElementById(`high-${symbol}`);
      const lowEl = document.getElementById(`low-${symbol}`);
      const volumeEl = document.getElementById(`volume-${symbol}`);
      const timeEl = document.getElementById(`time-${symbol}`);
      const precisionEl = document.getElementById(`precision-${symbol}`);
      const rawEl = document.getElementById(`raw-${symbol}`);

      // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
      if (lastPrices[symbol] !== undefined) {
        priceEl.classList.remove('flash-green', 'flash-red');
        if (data.futures.price > lastPrices[symbol]) {
          priceEl.classList.add('flash-green');
        } else if (data.futures.price < lastPrices[symbol]) {
          priceEl.classList.add('flash-red');
        }
      }
      
      lastPrices[symbol] = data.futures.price;

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
      priceEl.textContent = `$${data.futures.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
      
      changeEl.textContent = `${data.futures.change24h >= 0 ? '+' : ''}${data.futures.change24h.toFixed(2)}%`;
      changeEl.className = `change ${data.futures.change24h >= 0 ? 'positive' : 'negative'}`;
      
      highEl.textContent = `$${data.futures.high24h.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
      lowEl.textContent = `$${data.futures.low24h.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
      volumeEl.textContent = `${(data.futures.volume24h / 1000).toFixed(1)}K ${symbol.replace('USDT', '')}`;
      timeEl.textContent = new Date().toLocaleTimeString('ru-RU');
      precisionEl.textContent = data.futures.price.toFixed(8);
      rawEl.textContent = data.futures.rawData;
    }

    function updateAnalyticsCard(symbol, data) {
      if (!data) return;

      // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      console.log(`üîç Updating analytics for ${symbol} (${data.timeframe || '15m'}):`, data);

      // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
      if (data.analytics) {
        const analytics = data.analytics;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º LONG –∏ SHORT –ø—Ä–æ—Ü–µ–Ω—Ç—ã
        updateLongPercentage(symbol, analytics);
        updateShortPercentage(symbol, analytics);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥—É–ª—å "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–¥–µ–ª–∫–∏"
        updateDealPreparation(symbol, analytics);
        
        // EMA –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        updateIndicator(`ema9-${symbol}`, analytics.ema9, 'price');
        updateIndicator(`ema21-${symbol}`, analytics.ema21, 'price');
        updateIndicator(`ema50-${symbol}`, analytics.ema50, 'price');
        
          // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–∫–∏ —Ç—Ä–µ–Ω–¥–∞
          updateTrendDots(symbol, analytics.isUptrend, analytics.isDowntrend, analytics.ema9_21Signal);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º Bid/Ask —Å–∏–≥–Ω–∞–ª
          updateBidAskSignal(symbol, analytics);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º Volume —Å–∏–≥–Ω–∞–ª
          updateVolumeSignal(symbol, analytics);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º RSI —Å–∏–≥–Ω–∞–ª
          updateRsiSignal(symbol, analytics);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º Liquidity —Å–∏–≥–Ω–∞–ª
          updateLiquiditySignal(symbol, analytics);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º MACD —Å–∏–≥–Ω–∞–ª
          updateMacdSignal(symbol, analytics);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º ATR —Å–∏–≥–Ω–∞–ª
          updateAtrSignal(symbol, analytics);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º Spread —Å–∏–≥–Ω–∞–ª
          updateSpreadSignal(symbol, analytics);
        
        // MACD
        if (analytics.macd) {
          updateIndicator(`macd-${symbol}`, analytics.macd.macd, 'price');
          
          const macdDetails = document.getElementById(`macd-details-${symbol}`);
          if (macdDetails) {
            macdDetails.innerHTML = `
              <div class="macd-item">Signal: ${analytics.macd.signal ? analytics.macd.signal.toFixed(4) : '--'}</div>
              <div class="macd-item">Hist: ${analytics.macd.histogram ? analytics.macd.histogram.toFixed(4) : '--'}</div>
            `;
          }
        }
        
        // ATR
        updateIndicator(`atr-${symbol}`, analytics.atr, 'atr');
        
        // Volume Ratio
        updateIndicator(`volume-ratio-${symbol}`, analytics.volumeRatio, 'ratio');
      }
      
      // –î–∞–Ω–Ω—ã–µ —Å—Ç–∞–∫–∞–Ω–∞ –∑–∞—è–≤–æ–∫
      if (data.orderBook) {
        updateIndicator(`spread-${symbol}`, data.orderBook.spreadPercent, 'spread');
        updateIndicator(`liquidity-${symbol}`, data.orderBook.totalLiquidity, 'liquidity');
        updateIndicator(`bid-ask-ratio-${symbol}`, data.orderBook.bidAskRatio, 'bid-ask-ratio');
      }
    }

    function updateLongPercentage(symbol, analytics) {
      const longPercentageEl = document.getElementById(`long-percentage-${symbol}`);
      if (!longPercentageEl) return;

      const percentage = analytics.longPercentage || 0;
      longPercentageEl.textContent = `${percentage}%`;
      
      if (percentage > 0) {
        longPercentageEl.classList.add('long-active');
      } else {
        longPercentageEl.classList.remove('long-active');
      }
    }

    function updateShortPercentage(symbol, analytics) {
      const shortPercentageEl = document.getElementById(`short-percentage-${symbol}`);
      if (!shortPercentageEl) return;

      const percentage = analytics.shortPercentage || 0;
      shortPercentageEl.textContent = `${percentage}%`;
      
      if (percentage > 0) {
        shortPercentageEl.classList.add('short-active');
      } else {
        shortPercentageEl.classList.remove('short-active');
      }
    }

    function updateDealPreparation(symbol, analytics) {
      const longPercentage = analytics.longPercentage || 0;
      const shortPercentage = analytics.shortPercentage || 0;
      const currentPrice = lastPrices[symbol] || 0;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
      let dealDirection = null;
      let confidence = 0;
      let matchedIndicators = 0;
      let totalActiveIndicators = 0;
      
      if (longPercentage >= 55) {
        dealDirection = 'buy';
        confidence = longPercentage;
        // –°—á–∏—Ç–∞–µ–º —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è LONG (—Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ, –Ω–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ)
        if (analytics.ema9_21Signal === 'long') matchedIndicators++;
        if (analytics.macdSignal === 'long') matchedIndicators++;
        if (analytics.atrSignal === 'long') matchedIndicators++;
        if (analytics.rsiSignal && analytics.rsiSignal.includes('long')) matchedIndicators++;
        if (analytics.volumeSignal === 'long') matchedIndicators++;
        if (analytics.liquiditySignal === 'long') matchedIndicators++;
        if (analytics.bidAskSignal === 'long') matchedIndicators++;
        if (analytics.spreadSignal === 'long') matchedIndicators++;
        
        // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (–Ω–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã—Ö)
        if (analytics.ema9_21Signal !== 'neutral') totalActiveIndicators++;
        if (analytics.macdSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.atrSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.rsiSignal && analytics.rsiSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.volumeSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.liquiditySignal !== 'neutral') totalActiveIndicators++;
        if (analytics.bidAskSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.spreadSignal !== 'neutral') totalActiveIndicators++;
      } else if (shortPercentage >= 55) {
        dealDirection = 'sell';
        confidence = shortPercentage;
        // –°—á–∏—Ç–∞–µ–º —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è SHORT (—Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ, –Ω–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ)
        if (analytics.ema9_21Signal === 'short') matchedIndicators++;
        if (analytics.macdSignal === 'short') matchedIndicators++;
        if (analytics.atrSignal === 'short') matchedIndicators++;
        if (analytics.rsiSignal && analytics.rsiSignal.includes('short')) matchedIndicators++;
        if (analytics.volumeSignal === 'short') matchedIndicators++;
        if (analytics.liquiditySignal === 'short') matchedIndicators++;
        if (analytics.bidAskSignal === 'short') matchedIndicators++;
        if (analytics.spreadSignal === 'short') matchedIndicators++;
        
        // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (–Ω–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã—Ö)
        if (analytics.ema9_21Signal !== 'neutral') totalActiveIndicators++;
        if (analytics.macdSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.atrSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.rsiSignal && analytics.rsiSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.volumeSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.liquiditySignal !== 'neutral') totalActiveIndicators++;
        if (analytics.bidAskSignal !== 'neutral') totalActiveIndicators++;
        if (analytics.spreadSignal !== 'neutral') totalActiveIndicators++;
      }
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏
      if (dealDirection) {
        // –ï—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤–∞—è —Å–¥–µ–ª–∫–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–π–º–µ—Ä
        if (!dealPrepData[symbol]) {
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
          const timerSeconds = confidence >= 65 ? 60 : 120; // 1 –º–∏–Ω—É—Ç–∞ –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, 2 –º–∏–Ω—É—Ç—ã –¥–ª—è —Å–ª–∞–±—ã—Ö
          
          dealPrepData[symbol] = {
            direction: dealDirection,
            confidence: confidence,
            price: currentPrice,
            timestamp: Date.now(),
            timerSeconds: timerSeconds,
            matchedIndicators: matchedIndicators,
            totalActiveIndicators: totalActiveIndicators
          };
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
          saveDealPrepData();
        } else {
          // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ü–µ–Ω—É –∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
          const oldConfidence = dealPrepData[symbol].confidence;
          dealPrepData[symbol].confidence = confidence;
          dealPrepData[symbol].price = currentPrice;
          dealPrepData[symbol].matchedIndicators = matchedIndicators;
          dealPrepData[symbol].totalActiveIndicators = totalActiveIndicators;
          
          // –ï—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Å –Ω–∏–∑–∫–æ–π –Ω–∞ –≤—ã—Å–æ–∫—É—é, –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
          if (oldConfidence < 65 && confidence >= 65) {
            dealPrepData[symbol].timerSeconds = 60; // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ 1 –º–∏–Ω—É—Ç—É
            dealPrepData[symbol].timestamp = Date.now(); // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
          } else if (oldConfidence >= 65 && confidence < 65) {
            dealPrepData[symbol].timerSeconds = 120; // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
            dealPrepData[symbol].timestamp = Date.now(); // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
          }
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
          saveDealPrepData();
        }
        
        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
        createOrUpdateDealCard(symbol, dealPrepData[symbol]);
      } else {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É (–µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —É–ø–∞–ª–∞ –Ω–∏–∂–µ 50%)
        if (dealPrepData[symbol]) {
          const existingDirection = dealPrepData[symbol].direction;
          const currentConfidence = existingDirection === 'buy' ? longPercentage : shortPercentage;
          if (currentConfidence < 50) {
            removeDealCard(symbol);
            delete dealPrepData[symbol];
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            saveDealPrepData();
          }
        }
      }
    }

    function createOrUpdateDealCard(symbol, dealData) {
      const config = cryptoConfig[symbol];
      if (!config) return;
      
      let card = document.getElementById(`deal-card-${symbol}`);
      
      if (!card) {
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
        card = document.createElement('div');
        card.className = 'deal-card';
        card.id = `deal-card-${symbol}`;
        dealPrepGrid.appendChild(card);
      }
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º TP –∏ SL
      const entryPrice = dealData.price;
      const tpPrice = dealData.direction === 'buy' ? 
        (entryPrice * 1.0025).toFixed(4) : 
        (entryPrice * 0.9975).toFixed(4);
      const slPrice = dealData.direction === 'buy' ? 
        (entryPrice * 0.9987).toFixed(4) : 
        (entryPrice * 1.0013).toFixed(4);
      
      const tpPercent = dealData.direction === 'buy' ? '+0.25%' : '-0.25%';
      const slPercent = dealData.direction === 'buy' ? '-0.13%' : '+0.13%';
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const timerSeconds = dealData.timerSeconds || (dealData.confidence >= 65 ? 60 : 120);
      const minutes = Math.floor(timerSeconds / 60);
      const seconds = timerSeconds % 60;
      const timerDisplay = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç —Å—á–µ—Ç—á–∏–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
      const matchedCount = dealData.matchedIndicators || 0;
      const totalActive = dealData.totalActiveIndicators || 8;
      let matchColor = '#ef4444'; // –∫—Ä–∞—Å–Ω—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (0-3)
      if (matchedCount >= 6) {
        matchColor = '#10b981'; // –∑–µ–ª–µ–Ω—ã–π (6+)
      } else if (matchedCount >= 4) {
        matchColor = '#f59e0b'; // –æ—Ä–∞–Ω–∂–µ–≤—ã–π (4-5)
      }
      
      card.innerHTML = `
        <div class="deal-header">
          <div class="deal-symbol">${config.symbol} ${config.name}</div>
          <div class="deal-action ${dealData.direction}">${dealData.direction === 'buy' ? '–õ–û–ù–ì' : '–®–û–†–¢'}</div>
          <div class="deal-match-count" style="color: ${matchColor}; font-weight: 600;">${matchedCount}/${totalActive}</div>
        </div>
        
        <div class="deal-timer ${dealData.confidence >= 65 ? 'fast-timer' : 'standard-timer'}" id="timer-${symbol}">
          <div class="timer-value" id="timer-value-${symbol}">${timerDisplay}</div>
        </div>

        <div class="deal-confidence">
          <div class="confidence-left">
            <div class="confidence-label">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</div>
            <div class="confidence-bar">
              <div class="confidence-fill ${dealData.confidence >= 70 ? 'high' : dealData.confidence >= 40 ? 'medium' : 'low'}" style="width: ${dealData.confidence}%"></div>
            </div>
          </div>
          <div class="confidence-percent">${dealData.confidence}%</div>
        </div>
        
      `;
    }

    function removeDealCard(symbol) {
      const card = document.getElementById(`deal-card-${symbol}`);
      if (card) {
        card.remove();
      }
    }

      function updateTrendDots(symbol, isUptrend, isDowntrend, ema9_21Signal) {
        const dot1 = document.getElementById(`dot1-${symbol}`);
        const dot2 = document.getElementById(`dot2-${symbol}`);
        const dot3 = document.getElementById(`dot3-${symbol}`);
        
        if (!dot1 || !dot2 || !dot3) return;
      
        if (isUptrend) {
          // –ó–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞ (–≤—Å–µ —Ç—Ä–∏ EMA)
          dot1.className = 'dot green';
          dot2.className = 'dot green';
          dot3.className = 'dot green';
        } else if (isDowntrend) {
          // –ö—Ä–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –Ω–∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞ (–≤—Å–µ —Ç—Ä–∏ EMA)
          dot1.className = 'dot red';
          dot2.className = 'dot red';
          dot3.className = 'dot red';
        } else {
          // EMA 50 –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º EMA 9/21
          if (ema9_21Signal === 'long') {
            // EMA 9 > EMA 21 ‚Üí –∑–µ–ª–µ–Ω—ã–µ EMA 9 –∏ 21, —Å–µ—Ä–∞—è EMA 50
            dot1.className = 'dot green';
            dot2.className = 'dot green';
            dot3.className = 'dot neutral';
          } else if (ema9_21Signal === 'short') {
            // EMA 9 < EMA 21 ‚Üí –∫—Ä–∞—Å–Ω—ã–µ EMA 9 –∏ 21, —Å–µ—Ä–∞—è EMA 50
            dot1.className = 'dot red';
            dot2.className = 'dot red';
            dot3.className = 'dot neutral';
          } else {
            // –í—Å–µ —Å–µ—Ä—ã–µ
            dot1.className = 'dot neutral';
            dot2.className = 'dot neutral';
            dot3.className = 'dot neutral';
          }
        }
      }

      function updateBidAskSignal(symbol, analytics) {
        const bidAskDot = document.getElementById(`bid-ask-dot-${symbol}`);
        if (!bidAskDot) return;
      
        const signal = analytics.bidAskSignal || 'neutral';
        const ratio = analytics.bidAskRatio || 1.0;
        
        // Bid/Ask - —Ä–æ–º–±–∏–∫–∏ (borderRadius: 2px + rotate 45deg)
        bidAskDot.style.borderRadius = '2px';
        bidAskDot.style.transform = 'rotate(45deg)';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ä–æ–º–±–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞
        switch (signal) {
          case 'long':
            // –ó–µ–ª—ë–Ω—ã–π —Ä–æ–º–± - —É—Å—Ç–æ–π—á–∏–≤–æ–µ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π (2.0x-5.0x)
            bidAskDot.className = 'dot green';
            bidAskDot.innerHTML = '';
            break;
          case 'short':
            // –ö—Ä–∞—Å–Ω—ã–π —Ä–æ–º–± - —è–≤–Ω—ã–π –ø–µ—Ä–µ–∫–æ—Å –≤ —Å—Ç–æ—Ä–æ–Ω—É –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ (0.10x-0.90x)
            bidAskDot.className = 'dot red';
            bidAskDot.innerHTML = '';
            break;
          case 'volatile':
            // –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å - –∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ (—Ä–µ–∑–∫–∏–π —Å–∫–∞—á–æ–∫ > 1.0)
            bidAskDot.className = 'dot volatile';
            bidAskDot.innerHTML = '‚úï';
            break;
          default:
            // –°–µ—Ä—ã–π –∫—Ä—É–∂–æ–∫ - –Ω–µ—Ç —Å–∏–ª—å–Ω–æ–≥–æ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞
            bidAskDot.className = 'dot neutral';
            bidAskDot.innerHTML = '';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ Bid/Ask Ratio —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        const bidAskElement = document.getElementById(`bid-ask-ratio-${symbol}`);
        if (bidAskElement) {
          let displayText = `${ratio.toFixed(2)}x`;
          if (analytics.bidAskConfidence > 0) {
            displayText += ` (+${analytics.bidAskConfidence}%)`;
          }
          bidAskElement.textContent = displayText;
        }
      }

      function updateVolumeSignal(symbol, analytics) {
        const volumeDot = document.getElementById(`volume-dot-${symbol}`);
        if (!volumeDot) return;
      
        const signal = analytics.volumeSignal || 'neutral';
        const ratio = analytics.volumeRatio;
        
        // Volume - –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∏ (borderRadius: 2px)
        volumeDot.style.borderRadius = '2px';
        volumeDot.style.transform = 'none';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞
        switch (signal) {
          case 'long-weak':
            // –ó–µ–ª—ë–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç - –æ–±—ä–µ–º —Ä–∞—Å—Ç–µ—Ç (1.5-1.99)
            volumeDot.className = 'dot green';
            volumeDot.innerHTML = '';
            break;
          case 'long-strong':
            // –ó–µ–ª—ë–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç - —Å–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç –æ–±—ä–µ–º–∞ (2.0-2.99)
            volumeDot.className = 'dot green';
            volumeDot.innerHTML = '';
            break;
          case 'short-weak':
            // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫ - –æ–±—ä–µ–º –ø–∞–¥–∞–µ—Ç (< 0.7)
            volumeDot.className = 'dot red';
            volumeDot.innerHTML = '';
            break;
          case 'short-strong':
            // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫ - —Å–∏–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ (< 0.5)
            volumeDot.className = 'dot red';
            volumeDot.innerHTML = '';
            break;
          case 'caution':
            // –ñ–µ–ª—Ç—ã–π –∫—Ä—É–∂–æ–∫ - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å (3.0-19.99)
            volumeDot.className = 'dot caution';
            volumeDot.innerHTML = '';
            break;
          case 'anomaly':
            // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ - –∞–Ω–æ–º–∞–ª–∏—è (> 19.99)
            volumeDot.className = 'dot anomaly';
            volumeDot.innerHTML = '‚úï';
            break;
          case 'critical':
            // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ —Å –Ω–∞–¥–ø–∏—Å—å—é –ê–ù–û–ú–ê–õ–ò–Ø (‚â• 20.0)
            volumeDot.className = 'dot anomaly';
            volumeDot.innerHTML = '‚úï';
            break;
          default:
            // –°–µ—Ä—ã–π –∫—Ä—É–∂–æ–∫ - —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –æ–±—ä–µ–º (0.7-1.5)
            volumeDot.className = 'dot neutral';
            volumeDot.innerHTML = '';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ Volume Ratio
        const volumeElement = document.getElementById(`volume-ratio-${symbol}`);
        if (volumeElement) {
          if (ratio !== null) {
            let displayText = ratio.toFixed(2);
            
            if (signal === 'critical') {
              displayText = '–ê–ù–û–ú–ê–õ–ò–Ø';
            } else if (analytics.volumeConfidence > 0) {
              displayText += ` (+${analytics.volumeConfidence}%)`;
            }
            
            volumeElement.textContent = displayText;
          } else {
            volumeElement.textContent = '--';
          }
        }
      }

      function updateRsiSignal(symbol, analytics) {
        const rsiDot = document.getElementById(`rsi-dot-${symbol}`);
        if (!rsiDot) return;
      
        const signal = analytics.rsiSignal || 'neutral';
        const rsi = analytics.rsi || 50;
        
        // RSI - –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∏ (borderRadius: 2px)
        rsiDot.style.borderRadius = '2px';
        rsiDot.style.transform = 'none';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞
        switch (signal) {
          case 'long-extreme':
            // –ó–µ–ª—ë–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç - —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å (15-30)
            rsiDot.className = 'dot green';
            rsiDot.innerHTML = '';
            break;
          case 'long-strong':
            // –ó–µ–ª—ë–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç - —Å–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å (30-40)
            rsiDot.className = 'dot green';
            rsiDot.innerHTML = '';
            break;
          case 'long-weak':
            // –ó–µ–ª—ë–Ω—ã–π –∫—Ä—É–∂–æ–∫ - —É–º–µ—Ä–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å (40-50)
            rsiDot.className = 'dot green';
            rsiDot.innerHTML = '';
            break;
          case 'short-weak':
            // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫ - —É–º–µ—Ä–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å (60-70)
            rsiDot.className = 'dot red';
            rsiDot.innerHTML = '';
            break;
          case 'short-strong':
            // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫ - —Å–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å (70-80)
            rsiDot.className = 'dot red';
            rsiDot.innerHTML = '';
            break;
          case 'short-extreme':
            // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫ - —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å (80-100)
            rsiDot.className = 'dot red';
            rsiDot.innerHTML = '';
            break;
          default:
            // –°–µ—Ä—ã–π –∫—Ä—É–∂–æ–∫ - –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ (50-60 –∏ < 15)
            rsiDot.className = 'dot neutral';
            rsiDot.innerHTML = '';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ RSI
        const rsiElement = document.getElementById(`rsi-${symbol}`);
        if (rsiElement) {
          let displayText = rsi.toFixed(2);
          
          if (analytics.rsiConfidence > 0) {
            displayText += ` (+${analytics.rsiConfidence}%)`;
          }
          
          rsiElement.textContent = displayText;
        }
      }

      function updateLiquiditySignal(symbol, analytics) {
        const liquidityDot = document.getElementById(`liquidity-dot-${symbol}`);
        if (!liquidityDot) return;
      
        const signal = analytics.liquiditySignal || 'neutral';
        const ratio = analytics.liquidityRatio;
        
        // Liquidity - —Ä–æ–º–±–∏–∫–∏ (borderRadius: 2px + rotate 45deg)
        liquidityDot.style.borderRadius = '2px';
        liquidityDot.style.transform = 'rotate(45deg)';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ä–æ–º–±–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–≥–Ω–∞–ª–∞
        switch (signal) {
          case 'long':
            // –ó–µ–ª—ë–Ω—ã–π —Ä–æ–º–± - –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç (>= 1.15)
            liquidityDot.className = 'dot green';
            liquidityDot.innerHTML = '';
            break;
          case 'short':
            // –ö—Ä–∞—Å–Ω—ã–π —Ä–æ–º–± - –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç (< 0.85)
            liquidityDot.className = 'dot red';
            liquidityDot.innerHTML = '';
            break;
          default:
            // –°–µ—Ä—ã–π –∫—Ä—É–∂–æ–∫ - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å (0.85-1.15)
            liquidityDot.className = 'dot neutral';
            liquidityDot.innerHTML = '';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ Liquidity
        const liquidityElement = document.getElementById(`liquidity-${symbol}`);
        if (liquidityElement && analytics.orderBook) {
          const liq = analytics.orderBook.totalLiquidity;
          let displayText = liq >= 1000000 
            ? `$${(liq / 1000000).toFixed(2)}M` 
            : `$${(liq / 1000).toFixed(0)}k`;
          
          if (ratio !== null) {
            displayText += ` (${ratio.toFixed(2)})`;
          }
          
          if (analytics.liquidityConfidence > 0) {
            displayText += ` +${analytics.liquidityConfidence}%`;
          }
          
          liquidityElement.textContent = displayText;
        }
      }

      function updateMacdSignal(symbol, analytics) {
        const macdDot = document.getElementById(`macd-dot-${symbol}`);
        if (!macdDot) return;
      
        const signal = analytics.macdSignal || 'neutral';
        const confidence = analytics.macdConfidence || 0;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –∫—Ä—É–∂–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–≥–Ω–∞–ª–∞
        switch (signal) {
          case 'long':
            // –ó–µ–ª—ë–Ω—ã–π –∫—Ä—É–∂–æ–∫ - MACD > Signal (momentum —Ä–∞—Å—Ç–µ—Ç)
            macdDot.className = 'dot green';
            macdDot.innerHTML = '';
            break;
          case 'short':
            // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫ - MACD < Signal (momentum –ø–∞–¥–∞–µ—Ç)
            macdDot.className = 'dot red';
            macdDot.innerHTML = '';
            break;
          default:
            // –°–µ—Ä—ã–π –∫—Ä—É–∂–æ–∫ - –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
            macdDot.className = 'dot neutral';
            macdDot.innerHTML = '';
        }
      }

      function updateAtrSignal(symbol, analytics) {
        const atrDot = document.getElementById(`atr-dot-${symbol}`);
        if (!atrDot) {
          console.log(`ATR dot not found for ${symbol}`);
          return;
        }
      
        const signal = analytics.atrSignal || 'neutral';
        const confidence = analytics.atrConfidence || 0;
        
        console.log(`ATR ${symbol}: signal=${signal}, confidence=${confidence}, atr=${analytics.atr}`);
        
        // ATR - —Ä–æ–º–±–∏–∫–∏ (borderRadius: 2px + rotate 45deg)
        atrDot.style.borderRadius = '2px';
        atrDot.style.transform = 'rotate(45deg)';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ä–æ–º–±–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–≥–Ω–∞–ª–∞
        switch (signal) {
          case 'long':
            // –ó–µ–ª—ë–Ω—ã–π —Ä–æ–º–± - ATR –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ + EMA –≤ LONG
            atrDot.className = 'dot green';
            atrDot.innerHTML = '';
            break;
          case 'short':
            // –ö—Ä–∞—Å–Ω—ã–π —Ä–æ–º–± - ATR –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ + EMA –≤ SHORT
            atrDot.className = 'dot red';
            atrDot.innerHTML = '';
            break;
          default:
            // –°–µ—Ä—ã–π —Ä–æ–º–± - ATR –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏–ª–∏ EMA –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã
            atrDot.className = 'dot neutral';
            atrDot.innerHTML = '';
        }
        
        console.log(`ATR ${symbol} dot updated: ${signal} color`);
      }
      
      function updateSpreadSignal(symbol, analytics) {
        const spreadDot = document.getElementById(`spread-dot-${symbol}`);
        if (!spreadDot) {
          console.log(`Spread dot not found for ${symbol}`);
          return;
        }
      
        const signal = analytics.spreadSignal || 'neutral';
        const confidence = analytics.spreadConfidence || 0;
        
        console.log(`Spread ${symbol}: signal=${signal}, confidence=${confidence}`);
        
        // Spread - —Ä–æ–º–±–∏–∫–∏ (borderRadius: 2px + rotate 45deg)
        spreadDot.style.borderRadius = '2px';
        spreadDot.style.transform = 'rotate(45deg)';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ä–æ–º–±–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–≥–Ω–∞–ª–∞
        switch (signal) {
          case 'long':
            // –ó–µ–ª—ë–Ω—ã–π —Ä–æ–º–± - —É–∑–∫–∏–π —Å–ø—Ä–µ–¥ (—Ö–æ—Ä–æ—à–∏–µ —É—Å–ª–æ–≤–∏—è)
            spreadDot.className = 'dot green';
            spreadDot.innerHTML = '';
            break;
          case 'short':
            // –ö—Ä–∞—Å–Ω—ã–π —Ä–æ–º–± - —à–∏—Ä–æ–∫–∏–π —Å–ø—Ä–µ–¥ (–ø–ª–æ—Ö–∏–µ —É—Å–ª–æ–≤–∏—è)
            spreadDot.className = 'dot red';
            spreadDot.innerHTML = '';
            break;
          default:
            // –°–µ—Ä—ã–π —Ä–æ–º–± - –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥
            spreadDot.className = 'dot neutral';
            spreadDot.innerHTML = '';
        }
        
        console.log(`Spread ${symbol} dot updated: ${signal} color`);
    }

    function updateIndicator(elementId, value, type) {
      const element = document.getElementById(elementId);
      if (!element || value === null || value === undefined) return;

      let formattedValue = '--';
      let cssClass = 'neutral';

      switch (type) {
        case 'price':
          formattedValue = `$${value.toFixed(4)}`;
          break;
        case 'rsi':
          formattedValue = value.toFixed(2);
          if (value > 70) cssClass = 'negative'; // –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å
          else if (value < 30) cssClass = 'positive'; // –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å
          else cssClass = 'neutral';
          break;
        case 'ratio':
          formattedValue = value.toFixed(2) + 'x';
          if (value > 1.2) cssClass = 'positive'; // –í—ã—Å–æ–∫–∏–π –æ–±—ä–µ–º
          else if (value < 0.8) cssClass = 'negative'; // –ù–∏–∑–∫–∏–π –æ–±—ä–µ–º
          else cssClass = 'neutral';
          break;
        case 'spread':
          formattedValue = value.toFixed(4) + '%';
          cssClass = value < 0.1 ? 'positive' : (value < 0.5 ? 'neutral' : 'negative');
          break;
        case 'liquidity':
          // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á –∏ —Å–∏–º–≤–æ–ª–æ–º $
          if (value >= 1000000) {
            formattedValue = '$' + (value / 1000000).toFixed(1) + 'M';
          } else if (value >= 1000) {
            formattedValue = '$' + (value / 1000).toFixed(1) + 'K';
          } else {
            formattedValue = '$' + value.toFixed(0);
          }
          cssClass = 'neutral';
          break;
        case 'atr':
          // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è ATR —Å –±–æ–ª—å—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é
          formattedValue = value.toFixed(5);
          cssClass = 'neutral';
          break;
        case 'bid-ask-ratio': // Special case for Bid/Ask Ratio
          formattedValue = value.toFixed(2) + 'x';
          // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (< 0.8 –∏–ª–∏ > 2.0)
          if (value < 0.8 || value > 2.0) {
            cssClass = 'negative';
          } else {
            cssClass = 'neutral';
          }
          break;
        default:
          formattedValue = value.toFixed(4);
      }

      element.textContent = formattedValue;
      element.className = `indicator-value ${cssClass}`;
    }

    function updateSignalCard(symbol, data) {
      const analytics = data.analytics;
      const orderBook = data.orderBook;
      const spotPrice = data.spot.price;
      
      if (!analytics || !orderBook) return;

      console.log(`üéØ Calculating signal for ${symbol}:`, {
        ema9: analytics.ema9,
        ema21: analytics.ema21,
        ema50: analytics.ema50,
        rsi: analytics.rsi,
        macd: analytics.macd,
        volumeRatio: analytics.volumeRatio
      });

      // –†–∞—Å—á–µ—Ç confidence –¥–ª—è LONG
      let longScore = 0;

      // EMA —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (20 –±–∞–ª–ª–æ–≤)
      if (analytics.ema9 > analytics.ema21 && analytics.ema21 > analytics.ema50) {
        longScore += 20;
      }

      // MACD (15 –±–∞–ª–ª–æ–≤)
      if (analytics.macd && analytics.macd.macd > analytics.macd.signal && analytics.macd.histogram > 0) {
        longScore += 15;
      }

      // RSI (10 –±–∞–ª–ª–æ–≤)
      if (analytics.rsi >= 45 && analytics.rsi <= 70) {
        longScore += 10;
      } else if ((analytics.rsi >= 40 && analytics.rsi < 45) || (analytics.rsi > 70 && analytics.rsi <= 75)) {
        longScore += 5;
      }

      // Volume Ratio (15 –±–∞–ª–ª–æ–≤)
      if (analytics.volumeRatio >= 1.30) {
        longScore += 15;
      } else if (analytics.volumeRatio >= 1.00) {
        longScore += 8;
      }

      // –ë–æ–Ω—É—Å—ã
      if (analytics.volumeRatio >= 1.50) {
        longScore += 10;
      }

      // –†–∞—Å—á–µ—Ç confidence –¥–ª—è SHORT
      let shortScore = 0;

      // EMA —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (20 –±–∞–ª–ª–æ–≤)
      if (analytics.ema9 < analytics.ema21 && analytics.ema21 < analytics.ema50) {
        shortScore += 20;
      }

      // MACD (15 –±–∞–ª–ª–æ–≤)
      if (analytics.macd && analytics.macd.macd < analytics.macd.signal && analytics.macd.histogram < 0) {
        shortScore += 15;
      }

      // RSI (10 –±–∞–ª–ª–æ–≤)
      if (analytics.rsi >= 25 && analytics.rsi <= 55) {
        shortScore += 10;
      } else if ((analytics.rsi >= 20 && analytics.rsi < 25) || (analytics.rsi > 55 && analytics.rsi <= 60)) {
        shortScore += 5;
      }

      // Volume Ratio (15 –±–∞–ª–ª–æ–≤)
      if (analytics.volumeRatio >= 1.40) {
        shortScore += 15;
      } else if (analytics.volumeRatio >= 1.10) {
        shortScore += 8;
      }

      // –ë–æ–Ω—É—Å—ã
      if (analytics.volumeRatio >= 1.50) {
        shortScore += 10;
      }

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∏–≥–Ω–∞–ª
      let signal = 'HOLD';
      let confidence = 0;
      let tpPercent = 0;
      let slPercent = 0;

      console.log(`üìä ${symbol} Scores: LONG=${longScore}, SHORT=${shortScore}`);

      if (longScore >= 50) {
        signal = 'BUY';
        confidence = longScore;
        tpPercent = 0.25;
        slPercent = -0.13;
      } else if (shortScore >= 60) {
        signal = 'SELL';
        confidence = shortScore;
        tpPercent = -0.25;
        slPercent = 0.15;
      } else {
        confidence = Math.max(longScore, shortScore);
      }

      console.log(`üéØ ${symbol} Signal: ${signal}, Confidence: ${confidence}%`);

      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–≤–Ω–∏ –≤—Ö–æ–¥–∞, TP, SL
      const entryPrice = spotPrice;
      const tpPrice = entryPrice * (1 + tpPercent / 100);
      const slPrice = entryPrice * (1 + slPercent / 100);
      const riskReward = Math.abs(tpPercent / slPercent);

      // –û–±–Ω–æ–≤–ª—è–µ–º UI
      const badgeEl = document.getElementById(`signal-badge-${symbol}`);
      const confidenceValueEl = document.getElementById(`confidence-value-${symbol}`);
      const confidenceFillEl = document.getElementById(`confidence-fill-${symbol}`);
      const entryEl = document.getElementById(`entry-${symbol}`);
      const tpEl = document.getElementById(`tp-${symbol}`);
      const slEl = document.getElementById(`sl-${symbol}`);
      const rrEl = document.getElementById(`rr-${symbol}`);

      if (badgeEl) {
        badgeEl.textContent = signal;
        badgeEl.className = `signal-badge ${signal.toLowerCase()}`;
      }

      if (confidenceValueEl) {
        confidenceValueEl.textContent = `${confidence}%`;
      }

      if (confidenceFillEl) {
        confidenceFillEl.style.width = `${confidence}%`;
        if (confidence >= 70) {
          confidenceFillEl.className = 'confidence-fill high';
        } else if (confidence >= 40) {
          confidenceFillEl.className = 'confidence-fill medium';
        } else {
          confidenceFillEl.className = 'confidence-fill low';
        }
      }

      if (entryEl) {
        entryEl.textContent = `$${entryPrice.toFixed(4)}`;
      }

      if (tpEl && signal !== 'HOLD') {
        tpEl.textContent = `$${tpPrice.toFixed(4)} (${tpPercent > 0 ? '+' : ''}${tpPercent.toFixed(2)}%)`;
      }

      if (slEl && signal !== 'HOLD') {
        slEl.textContent = `$${slPrice.toFixed(4)} (${slPercent > 0 ? '+' : ''}${slPercent.toFixed(2)}%)`;
      }

      if (rrEl && signal !== 'HOLD') {
        rrEl.textContent = `1:${riskReward.toFixed(1)}`;
      }
    }

    // ============================================
    // –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    // ============================================
    let currentPage = 1;
    const itemsPerPage = 10;
    const maxPages = 10;
    
    function openHistoryModal() {
      const modal = document.getElementById('history-modal');
      modal.classList.add('show');
      currentPage = 1;
      renderHistoryPage();
    }
    
    function closeHistoryModal() {
      const modal = document.getElementById('history-modal');
      modal.classList.remove('show');
    }
    
    function renderHistoryPage() {
      const modalBody = document.getElementById('modal-body');
      const paginationInfo = document.getElementById('pagination-info');
      const pagination = document.getElementById('pagination');
      
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–¥–µ–ª–∫–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–µ—Ä–≤—ã–º–∏)
      const sortedDeals = [...closedDeals].reverse();
      
      // –ï—Å–ª–∏ –Ω–µ—Ç —Å–¥–µ–ª–æ–∫
      if (sortedDeals.length === 0) {
        modalBody.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <div class="empty-state-text">–ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –ø–æ–∫–∞ –ø—É—Å—Ç–∞</div>
            <p style="margin-top: 10px; color: #a0aec0; font-size: 14px;">–ó–∞–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å</p>
          </div>
        `;
        paginationInfo.textContent = '–ü–æ–∫–∞–∑–∞–Ω–æ 0-0 –∏–∑ 0';
        pagination.innerHTML = '';
        return;
      }
      
      // –†–∞—Å—á–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
      const totalPages = Math.min(Math.ceil(sortedDeals.length / itemsPerPage), maxPages);
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, sortedDeals.length, maxPages * itemsPerPage);
      const pageDeals = sortedDeals.slice(startIndex, endIndex);
      
      // –†–µ–Ω–¥–µ—Ä–∏–º —Ç–∞–±–ª–∏—Ü—É
      modalBody.innerHTML = `
        <table class="deals-table">
          <thead>
            <tr>
              <th>–ú–æ–Ω–µ—Ç–∞</th>
              <th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
              <th>–í—Ö–æ–¥</th>
              <th>–í—ã—Ö–æ–¥</th>
              <th>PnL</th>
              <th>%</th>
              <th>–í—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è</th>
              <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
            </tr>
          </thead>
          <tbody>
            ${pageDeals.map(deal => {
              const duration = formatDuration(deal.duration);
              const closeTime = new Date(deal.closeTime).toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              });
              
              const pnlClass = deal.realizedPnL >= 0 ? 'positive' : 'negative';
              const pnlSign = deal.realizedPnL >= 0 ? '+' : '';
              
              return `
                <tr>
                  <td><div class="deal-symbol">${deal.symbol.replace('USDT', '')}</div></td>
                  <td><span class="deal-direction ${deal.direction.toLowerCase()}">${deal.direction}</span></td>
                  <td>$${deal.entryPrice.toFixed(4)}</td>
                  <td>$${deal.exitPrice.toFixed(4)}</td>
                  <td><div class="deal-pnl ${pnlClass}">${pnlSign}$${deal.realizedPnL.toFixed(2)}</div></td>
                  <td><div class="deal-pnl ${pnlClass}">${pnlSign}${deal.profitPercent.toFixed(2)}%</div></td>
                  <td>${closeTime}</td>
                  <td>${duration}</td>
                </tr>
              `;
            }).join('')}
          </tbody>
        </table>
      `;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
      const displayedTo = Math.min(endIndex, maxPages * itemsPerPage);
      paginationInfo.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${startIndex + 1}-${displayedTo} –∏–∑ ${Math.min(sortedDeals.length, maxPages * itemsPerPage)}`;
      
      // –†–µ–Ω–¥–µ—Ä–∏–º –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
      let paginationHTML = `
        <button class="pagination-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Äπ</button>
      `;
      
      for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `
          <button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>
        `;
      }
      
      paginationHTML += `
        <button class="pagination-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>‚Ä∫</button>
      `;
      
      pagination.innerHTML = paginationHTML;
    }
    
    function goToPage(page) {
      const totalPages = Math.min(Math.ceil(closedDeals.length / itemsPerPage), maxPages);
      if (page < 1 || page > totalPages) return;
      currentPage = page;
      renderHistoryPage();
    }
    
    function formatDuration(ms) {
      const seconds = Math.floor(ms / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      
      if (hours > 0) {
        return `${hours}—á ${minutes % 60}–º`;
      } else if (minutes > 0) {
        return `${minutes}–º ${seconds % 60}—Å`;
      } else {
        return `${seconds}—Å`;
      }
    }
    
    // ============================================
    // –ê–≤—Ç–æ—Ç–æ—Ä–≥–æ–≤–ª—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    // ============================================
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å AUTO/MANUAL
    document.getElementById('auto-toggle').addEventListener('click', function() {
      isAutoTradingEnabled = !isAutoTradingEnabled;
      const toggle = this;
      const status = document.getElementById('toggle-status');
      
      if (isAutoTradingEnabled) {
        toggle.classList.add('active');
        status.textContent = 'AUTO';
        status.classList.remove('manual');
        status.classList.add('auto');
        console.log('ü§ñ –ê–≤—Ç–æ—Ç–æ—Ä–≥–æ–≤–ª—è –í–ö–õ–Æ–ß–ï–ù–ê');
      } else {
        toggle.classList.remove('active');
        status.textContent = 'MANUAL';
        status.classList.remove('auto');
        status.classList.add('manual');
        console.log('‚úã –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º');
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
      localStorage.setItem('autoTrading', isAutoTradingEnabled);
    });
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Ç–æ—Ä–≥–æ–≤–ª–∏
    const savedAutoTrading = localStorage.getItem('autoTrading');
    if (savedAutoTrading === 'true') {
      document.getElementById('auto-toggle').click();
    }
    
    // ============================================
    // –¢–∞–π–º–µ—Ä –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Å–≤–µ—á–∏
    // ============================================
    function getTimeToNextCandle() {
      const now = new Date();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      
      // –ù–∞–π—Ç–∏ —Å–ª–µ–¥—É—é—â—É—é –æ—Ç–º–µ—Ç–∫—É: 00, 15, 30, 45
      let nextMark;
      if (minutes < 15) {
        nextMark = 15;
      } else if (minutes < 30) {
        nextMark = 30;
      } else if (minutes < 45) {
        nextMark = 45;
      } else {
        nextMark = 60; // –°–ª–µ–¥—É—é—â–∏–π —á–∞—Å
      }
      
      const minutesToNext = nextMark - minutes;
      const secondsToNext = 60 - seconds;
      
      const totalSeconds = (minutesToNext - 1) * 60 + secondsToNext;
      
      const mins = Math.floor(totalSeconds / 60);
      const secs = totalSeconds % 60;
      
      return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    setInterval(() => {
      document.getElementById('candle-timer').textContent = getTimeToNextCandle();
    }, 1000);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∞–π–º–µ—Ä
    document.getElementById('candle-timer').textContent = getTimeToNextCandle();
    
    // ============================================
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
    // ============================================
    function updateTodayStats() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const todayDeals = closedDeals.filter(deal => {
        const dealDate = new Date(deal.closeTime);
        dealDate.setHours(0, 0, 0, 0);
        return dealDate.getTime() === today.getTime();
      });
      
      const todayProfitable = todayDeals.filter(d => d.realizedPnL > 0).length;
      const todayWinRate = todayDeals.length > 0 ? (todayProfitable / todayDeals.length * 100) : 0;
      const todayPnL = todayDeals.reduce((sum, d) => sum + d.realizedPnL, 0);
      
      document.getElementById('today-deals').textContent = todayDeals.length;
      document.getElementById('today-wr').textContent = `${todayWinRate.toFixed(0)}%`;
      
      const pnlEl = document.getElementById('today-pnl');
      const sign = todayPnL >= 0 ? '+' : '';
      pnlEl.textContent = `${sign}$${Math.abs(todayPnL).toFixed(0)}`;
    }
    
    // ============================================
    // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
    // ============================================
    document.getElementById('theme-toggle').addEventListener('click', function() {
      isDarkTheme = !isDarkTheme;
      const icon = document.getElementById('theme-icon');
      
      if (isDarkTheme) {
        document.body.classList.add('dark-theme');
        icon.textContent = '‚òÄÔ∏è';
        console.log('üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞');
      } else {
        document.body.classList.remove('dark-theme');
        icon.textContent = 'üåô';
        console.log('‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞');
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
      localStorage.setItem('darkTheme', isDarkTheme);
    });
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã
    const savedTheme = localStorage.getItem('darkTheme');
    if (savedTheme === 'true') {
      document.getElementById('theme-toggle').click();
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('history-toggle').addEventListener('click', openHistoryModal);
    document.getElementById('modal-close').addEventListener('click', closeHistoryModal);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
    document.getElementById('history-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeHistoryModal();
      }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    document.getElementById('stats-toggle').addEventListener('click', function(e) {
      e.stopPropagation();
      const dropdown = document.getElementById('stats-dropdown');
      const icon = document.getElementById('stats-icon');
      
      dropdown.classList.toggle('show');
      icon.classList.toggle('open');
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–µ–Ω—é
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('stats-dropdown');
      const toggle = document.getElementById('stats-toggle');
      const icon = document.getElementById('stats-icon');
      
      if (!toggle.contains(e.target)) {
        dropdown.classList.remove('show');
        icon.classList.remove('open');
      }
    });

    ws.onopen = () => {
      console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
    };

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–æ–≤
    function updateTimers() {
      Object.keys(dealPrepData).forEach(symbol => {
        const deal = dealPrepData[symbol];
        if (deal && deal.timerSeconds !== undefined && deal.timerSeconds > 0) {
          deal.timerSeconds--;
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
          const timerValueEl = document.getElementById(`timer-value-${symbol}`);
          if (timerValueEl) {
            const minutes = Math.floor(deal.timerSeconds / 60);
            const seconds = deal.timerSeconds % 60;
            timerValueEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —à–∫–∞–ª—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ü–≤–µ—Ç–æ–º
            const confidenceFillEl = document.querySelector(`#timer-${symbol}`).parentElement.querySelector('.confidence-fill');
            const confidencePercentEl = document.querySelector(`#timer-${symbol}`).parentElement.querySelector('.confidence-percent');
            if (confidenceFillEl) {
              const confidence = deal.confidence;
              confidenceFillEl.className = `confidence-fill ${confidence >= 70 ? 'high' : confidence >= 40 ? 'medium' : 'low'}`;
              confidenceFillEl.style.width = `${confidence}%`;
            }
            if (confidencePercentEl) {
              confidencePercentEl.textContent = `${deal.confidence}%`;
            }
          }
          
          // –ö–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä –∏—Å—Ç–µ–∫
          if (deal.timerSeconds === 0) {
            console.log(`‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ –¥–ª—è ${symbol}. –ú–æ–∂–Ω–æ –≤—Ö–æ–¥–∏—Ç—å –≤ —Å–¥–µ–ª–∫—É!`);
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É
            // –£–¥–∞–ª—è–µ–º –∏–∑ localStorage
            delete dealPrepData[symbol];
            saveDealPrepData();
          }
        }
      });
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    setInterval(updateTimers, 1000);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadDealPrepData();

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
      updateOpenPositionsPrices(data);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –∏ PnL (–µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏)
      if (openPositions.length > 0) {
        updateBalanceDisplay();
      }
      
      let longSignals = 0;
      let shortSignals = 0;
      let totalVolumeRatio = 0;
      let totalRsi = 0;
      let activeCoins = 0;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—É—é –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É
      Object.keys(data).forEach(symbol => {
        updateCryptoCard(symbol, data[symbol]);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É
        if (data[symbol].analytics || data[symbol].orderBook) {
          updateAnalyticsCard(symbol, data[symbol]);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
        if (data[symbol].analytics && data[symbol].orderBook) {
          updateSignalCard(symbol, data[symbol]);
        }
        
        // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –º–µ–Ω—é
        if (data[symbol].analytics) {
          activeCoins++;
          const analytics = data[symbol].analytics;
          
          if (analytics.longPercentage >= 55) longSignals++;
          if (analytics.shortPercentage >= 55) shortSignals++;
          
          if (analytics.volumeRatio) totalVolumeRatio += analytics.volumeRatio;
          if (analytics.rsi) totalRsi += analytics.rsi;
        }
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é
      updateTopMenu(activeCoins, longSignals, shortSignals, totalVolumeRatio, totalRsi);
    };
    
    function updateTopMenu(activeCoins, longSignals, shortSignals, totalVolumeRatio, totalRsi) {
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ updateBalanceDisplay()
      // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞/PnL
    }

    ws.onerror = (error) => {
      console.error('‚ùå –û—à–∏–±–∫–∞ WebSocket:', error);
    };

    ws.onclose = () => {
      console.log('‚ö†Ô∏è –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
      document.getElementById('menu-status').textContent = '–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
      Object.keys(cryptoConfig).forEach(symbol => {
        const priceEl = document.getElementById(`price-${symbol}`);
        if (priceEl) priceEl.textContent = '–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
      });
    };
  </script>
</body>
</html>

